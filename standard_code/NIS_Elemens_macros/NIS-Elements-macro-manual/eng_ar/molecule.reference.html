<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=" "> <title>Reference | NIS-Elements</title> <link rel="stylesheet" type="text/css" href="../css/syntax.css"> <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css"> <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css"> <link rel="stylesheet" type="text/css" href="../css/modern-business.css"> <link rel="stylesheet" type="text/css" href="../css/customstyles.css"> <link rel="stylesheet" type="text/css" href="../css/boxshadowproperties.css"> <link rel="stylesheet" type="text/css" href="../css/ekko-lightbox.min.css"> <link rel="stylesheet" type="text/css" href="../css/ne.css"> <script src="../js/jquery.min.js"></script> <script src="../js/jquery.cookie.min.js"></script> <script src="../js/jquery.navgoco.min.js"></script> <script src="../js/bootstrap.min.js"></script> <script src="../js/ekko-lightbox.min.js"></script> <script src="../js/lightbox.js"></script> <script src="../js/lim_help.js"></script> <script src="../js/jscopy.js"></script> <link rel="shortcut icon" href="../images/favicon_ne.ico""> <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml"> </head> <body> <!-- find project homepage --> <!-- Navigation --> <nav class="navbar navbar-inverse navbar-static-top"> <div class="container-fluid topnavlinks"> <ul class="nav navbar-nav navbar-left"> <!-- separate search window: --> <!--<li><a onclick='window.open("SearchWindow.html","Search","toolbar=0,location=0,directories=0,status=0,menubar=0,top=100,left=100,height=800,width=600");'><img src="images/zoomimage.svg" class="icon"/></a></li>--> <!-- embedded iframe search window: --> <li class="pull-right"> <a href="search.html?frompage=molecule.reference.html" id="searchButton" class="searchButton btn btn-primary" title="Search"> <img src="../images/zoomimage.svg" class="icon"/> </a> <div class="searchButtonWrapper"> </div> </li> <li> <a class="fa fa-lg navbar-brand" href="man.html" alt="NIS-Elements"> <img src="../images/logo_ne.svg"/> </a> </li> <!-- entries without drop-downs appear here --> <li><a href="man.html">User Manual</a></li> <li><a href="cr.html">Menu Commands</a></li> <li class="dropdown active"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="gpa.html">GPA</a></li> <li><a href="nis.ai.html">NIS.ai</a></li> <li><a href="measurement.3d.html">3D Measurement</a></li> <li><a href="analysis.modules.html">Bio Analysis Modules</a></li> <li><a href="app.concrete.html">Concrete</a></li> <li><a href="database.html">Database</a></li> <li><a href="app.deconvolution.html">Deconvolution</a></li> <li><a href="app.edf.html">Extended Depth of Focus</a></li> <li><a href="app.filters.html">Filter Particle Analysis</a></li> <li><a href="app.fret.html">FRET</a></li> <li><a href="app.ga3.html">General Analysis 3 </a></li> <li><a href="ug.hcajobs.html">HCA</a></li> <li><a href="app.hdr.html">HDR</a></li> <li><a href="GS_HowTo.IlluminationSequence.html">Illumination Sequence</a></li> <li><a href="ug.jobs.html">JOBS and HCA</a></li> <li><a href="app.layers.html">Layer Thickness Measurement</a></li> <li><a href="app.sequencer.html">Measurement Sequencer</a></li> <li><a href="app.metalo.castiron.html">Metalo - Cast Iron Analysis</a></li> <li><a href="app.metalo.grainsize.html">Metalo - Grain Size Analysis</a></li> <li><a href="app.nstorm.html">N-STORM</a></li> <li><a href="howto.triggeredacquisition.html">Triggered Acquisition</a></li> <li><a href="app.objectclassifier.html">Object Classifier</a></li> <li><a href="app.se.html">Smart Experiment</a></li> <li><a href="howto.tracking.html">Tracking</a></li> <li><a href="app.welds.html">Weld Measurement</a></li> </ul> </li> <li><a href="fr.html">Macro Functions</a></li> <!-- toggle sidebar button --> <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> --> </ul> </div> <!-- /.container --> </nav> <!-- Page Content --> <div class=""> <div id="main" class="fixedPage"> <!-- Sidebar Column --> <div class="fixedSidebar" id="tg-sb-sidebar"> <!--<p>--> <ul id="mysidebar" class="nav"> <li class="sidebarTitle">NIS-Elements AR </li> <li class="sidebarSub "> <a title="N-STORM" href="app.nstorm.html">N-STORM</a> </li> <li class=" hidearrow"><a title="N-STORM Acquisition and Analysis" href="nstorm.external.html">N-STORM Acquisition and Analysis</a> <ul> </ul> </li> <li class=" "><a title="Control Windows" href="p2c20s2.html">Control Windows</a> <ul> <li><a title="Molecule Options" href="molecule.options.html">Molecule Options</a></li> <li><a title="Molecule Analysis" href="molecule.analysis.html">Molecule Analysis</a></li> <li class="active"><a title="Reference" href="molecule.reference.html">Reference</a></li> </ul> </li> <li class=" hidearrow"><a title="N-STORM Z-Calibration (Agilent and LU4)" href="nstorm.zcalibration.html">N-STORM Z-Calibration (Agilent and LU4)</a> <ul> </ul> </li> <!--if you aren't using the accordion, uncomment this block:--> <!--<p class="external"> <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a> </p>--> </ul> <!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.--> <script>$("li.active").parents('li').toggleClass("active");</script> </div> <!-- Content Column --> <div class="fixedContent" id="tg-sb-content"> <div id="invalidHash"></div> <div class="section page"><div class="titlepage"><div><div><h3 class="title"><a name="molecule.reference"></a>Reference<button class="xmlid" data-clipboard-text="id|molecule.referencex">üîó</button></h3></div></div></div><div class="toc"><dl><dt><span class="section"><a href="molecule.reference.html#molecule.reference.batch.analysis">Batch Analysis</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.create.raster">Create raster document from molecules</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.determining.min.max.height">Determining Min and Max Height</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.identification.settings">Identification Settings</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.drift.correction">Molecule Drift Correction </a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.molecule.list.text.file">Molecule List Text File Format</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.roi.statistics">ROI Statistics </a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.xy.warp">XY Warp</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.zcalibration">Z-Calibration</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.zstack.alignment">Z-Stack Alignment</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.layers">Z-Stacked STORM</a></span></dt><dt><span class="section"><a href="molecule.reference.html#molecule.reference.faq">Frequently Asked Questions</a></span></dt></dl></div><p></p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.batch.analysis"></a>Batch Analysis<button class="xmlid" data-clipboard-text="id|molecule.reference.batch.analysisx">üîó</button></h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s1s1">Typical Workflow</a></span></dt></dl></div><p>Depending on the computer processing power and the amount of data STORM analysis may take a long time to complete. To facilitate processing of large amount of raw data N-STORM analysis software provides the capability to process multiple data sets in automatic unattended mode (typically overnight). User can create a list of data sets with their associated identification parameters and perform their sequential analysis. Batch processing is configured and launched from the <span class="guilabel">Batch STORM Analysis</span> dialog window.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_dialog.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_dialog.png" alt="../img/eng/moleculedetection_batch_storm_dialog.png image"></a><p class="title"><b>Figure&nbsp;1306.&nbsp;</b></p></div></div><div class="variablelist"><dl><div class="varlistentry"><span class="term"><img src="../res/base/open.png" height="12.5"> Load SBDx</span> <p>This button opens a standard Windows <span class="guilabel">Open File</span> dialog allowing the user to open a batch job file.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/save.png" height="12.5"> Save SBDx</span> <p>This button opens a standard Windows <span class="guilabel">Save File</span> dialog allowing the user to save the batch job file into the specified folder with a specified name.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/arr/item_add_down.png" height="12.5"> Add current ND2 as task</span> <p>This button inserts a new task line. The task line is populated with an ND2 file path, ID parameters, and selected period range currently set in the main dialog.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/trash.png" height="12.5"> Delete selected task(s)</span> <p>Deletes the selected tasks.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/trash_all.png" height="12.5"> Delete all the task(s)</span> <p>Deletes all tasks.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/arr/item_up.png" height="12.5"> Move selected task(s) up</span> <p>Moves the selected task(s) up.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/arr/item_down.png" height="12.5"> Move selected task(s) down</span> <p>Moves the selected task(s) down.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/settings.png" height="12.5"> Edit Identification parameters for selected task(s)</span> <p>Opens the <span class="guilabel">Identification Settings</span> dialog used for this input (please see <a class="xref" href="molecule.reference.html#molecule.reference.identification.settings">Identification Settings</a>).</p></div><div class="varlistentry"><span class="term"><img src="../res/base/updatere.png" height="12.5"> Start Batch Analysis</span> <p>Executes the batch job. Once the job is executed, this button changes to <span class="guilabel">Terminate Batch Job</span> so that the batch job can be stopped.</p></div><div class="varlistentry"><span class="term">Input</span> <p>Only the selected file type can be added to the list of tasks.</p></div><div class="varlistentry"><span class="term">Default Text Output</span> <p>Sets the default text output.</p></div><div class="varlistentry"><span class="term"><img src="../res/base/device/devicemanager_checkbox_sel.png" height="12.5"></span> <p>Each row corresponds to one task. If this option is checked, the selected task is included in the current job.</p></div><div class="varlistentry"><span class="term">Data Set</span> <p>Shows the file system path to the raw data set associated with each task. Double-clicking on the data set name opens the selected source image.</p></div><div class="varlistentry"><span class="term">Identification Parameters</span> <p>Shows identification parameters for each task. Double-click on the parameters opens the <span class="guilabel">Identification Settings</span> dialog window used for adjusting the parameters (please see <a class="xref" href="molecule.reference.html#molecule.reference.identification.settings">Identification Settings</a>).</p></div><div class="varlistentry"><span class="term">Analysis Range</span> <p>Displays the period (or Time slice for Live Cell data) range for each task.</p></div><div class="varlistentry"><span class="term">ROIs</span> <p>Displays any available ROI(s).</p></div><div class="varlistentry"><span class="term">Text Output</span> <p>Specifies the optional text output format.</p></div><div class="varlistentry"><span class="term">Status</span> <p>This column is active only when the batch job is running. It displays the status of each task. For the tasks that have not yet started it is blank. For the currently active task it displays the percentage progress of each step. For processed tasks the status can be <span class="quote">‚Äú<span class="quote">Completed</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Terminated</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Failed</span>‚Äù</span> for STORM Analysis tasks, or number of molecules output for Molecule List Conversion tasks. Some of the common failures have specific descriptions such as <span class="quote">‚Äú<span class="quote">Failed to load</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Failed to Identify</span>‚Äù</span>, etc.</p></div><div class="varlistentry"><span class="term">unique, </span><span class="term">overwrite, </span><span class="term">rename old</span> <p><span class="guilabel">Unique</span> (default) generates unique names as described above. <span class="guilabel">Overwrite</span> saves the output with a default name, overwrites the old one if it exists. <span class="guilabel">Rename old</span> saves the output with a default name, renames the old one if it exists.</p></div></dl></div><p>Processing of a single data set is called a <span class="guilabel">Batch Task</span>. One or more Batch Tasks combined are called a <span class="guibutton">Batch Job</span>. The <span class="guilabel">Batch STORM Analysis</span> dialog represents one batch job and has a list of its tasks. There are two basic types of batch tasks:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>STORM analysis.</p></li><li class="listitem"><p>Molecule list conversion (generates one or more text molecule lists from the binary molecule list).</p></li></ol></div><p>Each row in the list corresponds to one task. The check boxes in the left column control inclusion and exclusion of their corresponding tasks in the current job. The second column contains the file system path to the raw <span class="guilabel">Data Set</span> associated with each task. The third column holds <span class="guilabel">Identification Parameters</span> (such as CCD Background, Min Peak Height, etc.) for each task. The <span class="guilabel">Analysis Range</span> (or Time slice for Live Cell data) for each task resides in the fourth column. The third and fourth columns are not applicable to Molecule List Conversion tasks. Fifth column is used to specify the optional <span class="guilabel">Text Output</span> format. The last (sixth) column is active only when the batch job is running. It displays the <span class="guilabel">Status</span> of each task. For the tasks that have not yet started it is blank. For the currently active task it displays the percentage progress of each step. For processed tasks the status can be <span class="quote">‚Äú<span class="quote">Completed</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Terminated</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Failed</span>‚Äù</span> for STORM Analysis tasks, or number of molecules output for Molecule List Conversion tasks. Some of the common failures have specific descriptions such as <span class="quote">‚Äú<span class="quote">Failed to load</span>‚Äù</span> or <span class="quote">‚Äú<span class="quote">Failed to Identify</span>‚Äù</span>, etc.</p><p><b>Text output format column&nbsp;</b><br>This column for a newly added task is set to <span class="quote">‚Äú<span class="quote">Default</span>‚Äù</span>. In this mode, the global <span class="guilabel">Default Text Output</span> at the top right of the <span class="guilabel">Batch STORM</span> dialog window is applied.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_text_output_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_text_output_01.png" alt="../img/eng/moleculedetection_batch_storm_text_output_01.png image"></a><p class="title"><b>Figure&nbsp;1307.&nbsp;</b></p></div></div><p>Each task can have independent setting by specifying <span class="guilabel">Text Output</span> options other than <span class="guilabel">Default</span> as shown below.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_text_output_02.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_text_output_02.png" alt="../img/eng/moleculedetection_batch_storm_text_output_02.png image"></a><p class="title"><b>Figure&nbsp;1308.&nbsp;</b></p></div></div><p>Multiple tasks can be selected and applied the same <span class="guilabel">Text Output</span> option also.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_text_output_03.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_text_output_03.png" alt="../img/eng/moleculedetection_batch_storm_text_output_03.png image"></a><p class="title"><b>Figure&nbsp;1309.&nbsp;</b></p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s1s1"></a>Typical Workflow<button class="xmlid" data-clipboard-text="id|p2c20s2s3s1s1x">üîó</button></h5></div></div></div><p>To Add a STORM analysis task, load a data set, adjust the identification parameters, set the analysis range, and then use the <img src="../res/base/arr/item_add_down.png" height="12.5"> toolbar button. This should add a new row to the list of tasks and copy the current combination of the file path, identification settings, and analysis range. Alternatively one or multiple ND2 files can be dragged and dropped onto the <span class="guilabel">Batch STORM Analysis</span> window from <span class="emphasis"><em>Windows Explorer</em></span>. Files which have identification settings embedded show up as batch tasks with those settings. Newly acquired files inherit the current system set of identification settings.</p><p>The input for STORM analysis task is an ND2 file. The output of STORM analysis task is a binary molecule list. The input of molecule list conversion task is a binary molecule list. The output of the molecule list conversion task is a text formatted molecule list. STORM analysis task can optionally produce text molecule list in addition to unconditionally produced binary molecule list. To add binary molecule list conversion tasks drag and drop one or more binary molecule list files from <span class="emphasis"><em>Windows Explorer</em></span> to the <span class="guilabel">Batch STORM Analysis</span> window. STORM analysis and molecule list conversion tasks can be mixed in a single batch job. Adding tasks via drag and drop also supports folders. When a folder is dropped onto the <span class="guilabel">Batch STORM Analysis</span> window it is searched for all ND2 files (extension .nd2) and binary molecule lists (extension .bin).</p><p>The <span class="guilabel">Input</span> drop down list works as a filter during folder or multi-file drag and drop operations. It can accept only ND2 files, or only binary molecule lists, or both.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_input_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_input_01.png" alt="../img/eng/moleculedetection_batch_storm_input_01.png image"></a><p class="title"><b>Figure&nbsp;1310.&nbsp;</b></p></div></div><p>Select the desired option before adding tasks using drag and drop. If the set of files being dropped contains only one type of files (for example only molecule lists) but the input filter is set to only accept the other type (ND2 files for this example) then, as a convenience feature, the filter is ignored and the dropped files are accepted as batch tasks.</p><p>The task list supports common Windows multiple item selection behavior using <span class="keycap"><strong>Shift</strong></span> or <span class="keycap"><strong>Ctrl</strong></span>. Highlighted tasks as a group or individually can be moved up and down the list (<img src="../res/base/arr/item_up.png" height="12.5"> <img src="../res/base/arr/item_down.png" height="12.5">) or deleted (<img src="../res/base/trash.png" height="12.5">). To quickly clear the job, all tasks can be deleted at once (<img src="../res/base/trash_all.png" height="12.5">). While batch job is in the setup mode (not running) the main STORM dialog is accessible and can be used to configure individual tasks (one at a time). To edit an existing task user can use the toolbar buttons. The <img src="../res/base/open.png" height="12.5"> button loads the tasks data set, identification parameters, and analysis range into the analysis module. The <img src="../res/base/settings.png" height="12.5"> button facilitates editing of identification settings for the corresponding task. The same button on the toolbar edits identification settings of the first highlighted task. Once clicked, it brings up a standard <span class="guilabel">Identification Settings</span> dialog (<a class="xref" href="molecule.reference.html#molecule.reference.identification.settings">Identification Settings</a>) pre-populated with values pertaining to the task.</p><p><span class="guilabel">Default Text Output</span> is optional for STORM Analysis tasks and mandatory for binary molecule list conversion tasks.</p><p>The entire batch job can be saved into and loaded from a file using <img src="../res/base/open.png" height="12.5"> and <img src="../res/base/save.png" height="12.5"> buttons that open standard Windows Open File and Save File dialogs with file filters set for STORM Batch Data (*.sbd) files. A STORM Batch Data file can also be dragged and dropped onto the <span class="guilabel">Batch STORM</span> dialog to open.</p><p>Use the <img src="../res/base/updatere.png" height="12.5"> button to execute the current batch job. Once the batch job is active, the main <span class="guilabel">Batch STORM Analysis</span> dialog becomes unavailable until the batch is stopped or finished.</p><p>While the batch job runs the molecule lists are saved in the same directories with their respective ND2 data sets. To avoid file naming conflicts the molecule list file names are suffixed with the time stamp at the time when each is saved. This is the default behavior. It can be changed to one of the behaviors by clicking on the status bar right pane (<span class="guilabel">unique</span>/<span class="guilabel">overwrite</span>/<span class="guilabel">rename old</span>).</p><div class="variablelist reference"><dl><div class="varlistentry"><span class="term">unique</span> <p>This default option generates unique names and described above.</p></div><div class="varlistentry"><span class="term">overwrite</span> <p>Saves the output with a default name, overwrites the old one if it already exists.</p></div><div class="varlistentry"><span class="term">rename old</span> <p>Saves the output with a default name, renames the old one if it already exists.</p></div></dl></div><p><b>Output Molecule List File Name Format&nbsp;</b><br>To avoid file name conflict, molecule list files saved by the batch processing have the following format:</p><p>&lt;ND2-file-title&gt;_list-&lt;Timestamp&gt;_S&lt;#&gt;.bin</p><p>where:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><span class="emphasis"><em>&lt;ND2-file-title&gt;</em></span> is a data set ND2 file name without the extension (.nd2)</p></li><li class="listitem"><p><span class="emphasis"><em>&lt;Timestamp&gt;</em></span> is the date and time when the batch job is started (e.g. 2019-01-30-13-45-05)</p></li><li class="listitem"><p>&lt;#&gt; is the row number in the task list (1~)</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.create.raster"></a>Create raster document from molecules<button class="xmlid" data-clipboard-text="id|molecule.reference.create.rasterx">üîó</button></h4></div></div></div><p>This dialog window is used for creating a custom raster document from the currently opened molecule image.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/showcontrol.moleculescontrol_create_raster.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/showcontrol.moleculescontrol_create_raster.png" alt="../img/eng/showcontrol.moleculescontrol_create_raster.png image"></a><p class="title"><b>Figure&nbsp;1311.&nbsp;</b></p></div></div><div class="variablelist"><dl><div class="varlistentry"><span class="term">Source</span> <p>Set the source area to be exported either by entering the Top/Left/Width/Height values or simply by repositioning the red rectangle in the image. Make sure proper units are selected.</p></div><div class="varlistentry"><span class="term">Target</span> <p>Set the target size (Width/Height) of the image being created and optionally set its calibration and zoom (image magnification).</p></div><div class="varlistentry"><span class="term">Channels to tabs</span> <p>If multiple channels are present in the image, the created document will have each mono channel as a separate tab. If this option is not checked, a RGB image will be created.</p></div><div class="varlistentry"><span class="term">Export time</span> <p>If checked, this function exports <span class="guilabel">Time grouping</span> as a T dimension.</p></div><div class="varlistentry"><span class="term">Export Z-grouping as Z-stack</span> <p>If checked, this function exports <span class="guilabel">Z grouping</span> as a Z dimension.</p></div><div class="varlistentry"><span class="term">Export Layers as Z-stack</span> <p>If checked, this function exports <span class="guilabel">Layers</span> as a Z dimension.</p></div></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.determining.min.max.height"></a>Determining Min and Max Height<button class="xmlid" data-clipboard-text="id|molecule.reference.determining.min.max.heightx">üîó</button></h4></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Turn on <span class="guilabel">Show Conventional Image</span> in the STORM Display Options dialog.</p></li><li class="listitem"><p>In the N-STORM window, move the Period Slider to the middle of the dataset.</p></li><li class="listitem"><p>Make sure an activation frame is not currently being displayed. If so, move the frame slider to an imaging frame.</p></li><li class="listitem"><p>In most cases the correct CCD Baseline value will be automatically determined based on the camera model. N-STORM analysis software displays the CCD Baseline edit field only when it fails to find the correct value. In that case enter correct CCD Baseline value for the camera used to acquire the raw data. It can be evaluated by looking at the average pixel intensity in an image captured without any light striking the camera sensor.</p></li><li class="listitem"><p>Hover the mouse over the candidate PSF peaks. Look at the status bar to see the intensity under the mouse cursor.</p></li><li class="listitem"><p>Find representative intensity peaks in the image and determine the relative peak intensity and the local background intensities around each peak. Subtract the local background from the central peak.</p></li><li class="listitem"><p>Repeat <span class="guilabel">Step 6</span> for a few peaks over several images to find the smallest (<span class="guilabel">Min. Height</span>) and largest (<span class="guilabel">Max Height</span>) relative peak heights that should be considered molecules.</p></li></ol></div><p>The procedure above assumes that the user is looking at the <span class="guilabel">Status Bar</span> to view the intensity of the pixel it is currently hovering over.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.identification.settings"></a>Identification Settings<button class="xmlid" data-clipboard-text="id|molecule.reference.identification.settingsx">üîó</button></h4></div></div></div><p>The <span class="guilabel">Identification Settings</span> dialog is the first and most important step to making sure that the STORM Image is properly created. This section (and subsequent sections) is an explanation of each setting and suggested values or methods to determine the correct values.</p><div class="variablelist"><dl><div class="varlistentry"><span class="term">Auto Minimum Height</span> <p>Check this box to perform automatic min height detection during analysis. When auto min height is selected the software runs a short (100 periods in the middle of selection range) pre-analysis with relaxed identification constraints to determine the optimal min height for a given data set. This feature is not available when a Z Calibration data set is loaded.</p></div><div class="varlistentry"><span class="term">Auto Fit ROI</span> <p>Check this box to allow fitting algorithm consider variable number of pixels depending on width and axial ratio of each individual peak. When this check box is cleared a fixed size pixel rectangle (typically 5 x 5 pixels) is used for fitting. <span class="guilabel">Auto Fit ROI</span> is recommended for 3D analysis. Fixed size ROI is recommended for 2D analysis.</p></div><div class="varlistentry"><span class="term">Minimum Height</span> <p>The intensity of the smallest (dimmest) peaks (minus the local background of that peak) to be identified as molecules. Any object whose peak intensity is below this value will not be identified. Please see <a class="xref" href="molecule.reference.html#molecule.reference.determining.min.max.height">Determining Min and Max Height</a>. If auto min height feature is selected the Minimum Height displays ‚Äúauto‚Äù until the N-STORM analysis is performed at which point the ‚Äúauto‚Äù is replaced with the actual calculated min height value.</p></div><div class="varlistentry"><span class="term">Maximum Height</span> <p>The intensity of the largest (brightest) peaks to be identified as molecules. Any object whose peak intensity is above this value will not be identified. Please see <a class="xref" href="molecule.reference.html#molecule.reference.determining.min.max.height">Determining Min and Max Height</a>.</p></div><div class="varlistentry"><span class="term">Baseline</span> <p>Closed shutter (zero photons) pixel response. For Andor DU897 and for Hamamatsu Orca Flash 4.0 cameras it should always be 100. When currently loaded ND2 file was acquired with an officially supported camera, the CCD Baseline field becomes read-only and is automatically populated with the name of the camera manufacturer and the correct for the camera baseline value.</p></div><div class="varlistentry"><span class="term">Minimum Width</span> <p>The smallest possible width a spot of some intensity in the image to be identified as a molecule by STORM Analysis.</p></div><div class="varlistentry"><span class="term">Maximum Width</span> <p>The maximum possible width a spot of some intensity in the image to be identified as a molecule by STORM Analysis. A suggested default for 2D is 400nm. For 3D STORM, this should be slightly larger to take in account defocused molecules (above and below the focal plane). A suggested default for 3D is 700 nm.</p></div><div class="varlistentry"><span class="term">Initial Fit Width</span> <p>This value is used as a starting point for STORM Analysis for identifying molecules. For 2D STORM, this is the expected value of a diffraction limited spot. A suggested default for both 2D and 3D is 300 nm.</p></div><div class="varlistentry"><span class="term">Max Axial Ratio</span> <p>Fluorescent spots whose ratio of elongation in the X and Y direction is larger than this threshold will be rejected as a single molecule. It is typically set to 1.3 for 2D STORM and 2.5 for 3D STORM.</p></div><div class="varlistentry"><span class="term">Max Displacement</span> <p>This value sets the maximum distance (in pixels) that a molecule identified in one frame can be located from a molecule identified in the previous frame to be considered the same molecule and arising from the same Activation frame. The default value is 1. As mentioned in Z-Calibration section for Z Calibration files this value is ignored and 0 is used during STORM analysis.</p></div><div class="varlistentry"><span class="term">Default</span> <p>This button can be used to quickly bring Max Width and Max Axial Ratio in correspondence with current 2D/3D status of the data. For 2D Max Width is set to 400 nm and Max Axial Ratio to 1.3. For 3D these settings are 700 nm and 2.5 correspondingly.</p></div><div class="varlistentry"><span class="term">3D</span> <p>This checkbox indicates whether the dataset will be considered 2D or 3D during the analysis and subsequent display of results. This setting is typically applied prior to acquisition when the experiment is defined. During acquisition, it is stored to the ND file and read when the file is opened in the N-STORM module. However, this setting can be overwritten by checking or unchecking this box.</p></div><div class="varlistentry"><span class="term">Fit Overlapping Peaks</span> <p>This check box selects the fitting algorithm used for molecule localization. When cleared, regular single Gaussian peak fitting algorithm is used. When checked, the software attempts to discover partially overlapping peaks and perform Gaussian fitting that accounts for such overlap. This algorithm generally produces better results with fluorophores whose blinking efficiency is less than that of Alexa647 (for example Atto488) or in densely labeled and over activated areas where molecule peaks tend to overlap in their respective frames. Algorithm that accounts for overlap may take longer time to compute. A reminder is displayed at the beginning of analysis (excluding Test) when Fit Overlapping Peaks is enabled. This reminder can be disabled for the session.</p></div></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.drift.correction"></a>Molecule Drift Correction <button class="xmlid" data-clipboard-text="id|molecule.reference.drift.correctionx">üîó</button></h4></div></div></div><p>Drift correction is a process that looks at each frame of the dataset and correlates the amounts of drift that may have occurred over time. For 2D STORM datasets, only the lateral (X, Y) drift correction is performed. For 3D datasets, both the lateral and the axial drifts are corrected.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_drift_correction_sample.png" title="" data-title="Difference between Drift Corrected (left) and non-Drift Corrected (right) data "><img class="img-responsive" src="../img/eng/moleculedetection_drift_correction_sample.png" alt="../img/eng/moleculedetection_drift_correction_sample.png image"></a><p class="title"><b>Figure&nbsp;1312.&nbsp;Difference between Drift Corrected (left) and non-Drift Corrected (right) data</b></p></div></div><p>Drift correction is an automated process. It can be completed as part of STORM Analysis (check box in the STORM Analysis).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_drift_correction_checkbox.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_drift_correction_checkbox.png" alt="../img/eng/moleculedetection_drift_correction_checkbox.png image"></a><p class="title"><b>Figure&nbsp;1313.&nbsp;</b></p></div></div><p>There are two types of drift correction. One uses the entire set of molecules to track the drift. This method is called <span class="guilabel">Molecule Drift Correction</span>. The other method (<span class="guilabel">Bead Drift Correction</span>) tracks registration fiducials (also called beads) attached to the cover glass. These beads fluoresce just like fluorophore molecules and their STORM localizations are attributed to dedicated <span class="quote">‚Äú<span class="quote">Drift Correction</span>‚Äù</span> channel. If STORM data set contains Drift Correction channel (set during acquisition), then by default the latter drift correction method is used. There is still an option to use the <span class="guilabel">Molecule Drift Correction</span> for drift correction if the data set is acquired as fixed cell however it cannot be used for drift correction in live cell data because the live cell molecule motion obscures the drift.</p><p>Bead drift correction depends on the quality of the captured bead data. Ideally there should be several beads that remain attached to the cover glass and visibly fluorescent in all bead frames. Also ideally extraneous beads should not float around beads tracked from the beginning, and molecule localizations should not appear near beads in the <span class="quote">‚Äú<span class="quote">Drift Correction</span>‚Äù</span> channel. In practice these conditions are not always met. The analysis software has a certain amount of tolerance built in it. All beads visible in the first bead frame are the candidates for tracking. Some of them may get disqualified as the tracking progresses. Disqualified beads are called <span class="quote">‚Äú<span class="quote">bad</span>‚Äù</span> and those that can be successfully tracked are called <span class="quote">‚Äú<span class="quote">good</span>‚Äù</span>. At the end of the bead drift correction <span class="quote">‚Äú<span class="quote">good</span>‚Äù</span> beads are marked with circles if ROI mode is enabled.</p><p>The center of the circle is a mid-point between the first and the last bead localization within each good bead trace. Diameter of the circle is proportional to the amount of drift at reasonably high zoom levels. In a relatively zoomed out view the circles have a fixed size. Otherwise they would be impractically small. Filter settings may exclude some bead localizations from the drift correction calculation, thus affecting qualification of the bead traces.</p><p><span class="guilabel">Color with Frame</span> mode (also called <span class="guilabel">Time Map rendering</span>) is useful to visually evaluate bead traces. It can be toggled by the <span class="keycap"><strong>Ctrl+Shift+F</strong></span> key combination. Besides mapping the color to the frame number, for live cell data this mode shows all bead localizations at once (as opposed to single time slice worth of localizations as is normal for live cell rendering). Although <span class="guilabel">Color with Frame</span> mode can be used for other (non-bead) localizations, it is particularly useful for beads.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_drift_correction_color_with_frame.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_drift_correction_color_with_frame.png" alt="../img/eng/moleculedetection_drift_correction_color_with_frame.png image"></a><p class="title"><b>Figure&nbsp;1314.&nbsp;</b></p></div></div><p>Ideally all the <span class="quote">‚Äú<span class="quote">good bead</span>‚Äù</span> traces should look similar. If certain bead traces look better (less spread) than others, then only those can be used as candidates for drift calculation. To do this, draw multi ROIs around good bead candidates, and then click the top toolbar <span class="guibutton">Bead Drift Correction</span> button.</p><p>Even with manual bead selection the algorithm still evaluates bead quality and can reject some beads. In an extreme case all of the bead candidates may get rejected, which leads to a bead drift correction failure. When bead drift correction fails on fixed cell data set, autocorrelation method can still be used and is automatically offered.</p><p>Ideally, beads should be wavelength separated from the molecules. In other words, bead localizations should not show up in the molecule channels and the other way around. In practice this is often not true. N-STORM analysis software offers an option to hide bead localizations in the molecule channels. This is done by hiding all molecule localizations located within a small radius of bead localizations. The radius can be adjusted via <span class="quote">‚Äú<span class="quote">Phantom Bead Mols Search Radius</span>‚Äù</span> ini file variable. When data set with bead drift correction is loaded, <span class="quote">‚Äú<span class="quote">Hide Localizations near Beads</span>‚Äù</span> pop-up menu option becomes available.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_drift_correction_hide_locations.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_drift_correction_hide_locations.png" alt="../img/eng/moleculedetection_drift_correction_hide_locations.png image"></a><p class="title"><b>Figure&nbsp;1315.&nbsp;</b></p></div></div><p>Hiding of molecules near beads can also be toggled via <span class="keycap"><strong>Ctrl + H, B</strong></span> sequence of keystrokes. After the initial <span class="keycap"><strong>Ctrl + H</strong></span> keystroke the window title displays one of the context sensitive reminder prompts below.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.molecule.list.text.file"></a>Molecule List Text File Format<button class="xmlid" data-clipboard-text="id|molecule.reference.molecule.list.text.filex">üîó</button></h4></div></div></div><p>Each molecule in the text file will be listed on a separate line. Each line will contain the following pieces of information about that molecule:</p><div class="table"><a name="d0e122998"></a><p class="title"><b>Table&nbsp;17.&nbsp;</b></p><div class="table-contents"><table summary="" style="border-collapse: collapse;"><colgroup><col><col></colgroup><thead><tr><th style="" align="center">Field Name</th><th style="" align="center">Description</th></tr></thead><tbody><tr><td style="">Channel Name</td><td style="">This is the name of the Channel where the molecule was detected.</td></tr><tr><td style="">X</td><td style="">The X position of the centroid of the molecule in nanometers. Similar to the conventional image, molecules positions in the image are relative to the upper left corner of the image.</td></tr><tr><td style="">Y</td><td style="">The Y position of the centroid of the molecule in nanometers. Similar to the conventional image, molecules positions in the image are relative to the upper left corner of the image.</td></tr><tr><td style="">Xc</td><td style="">The X position of the centroid of the molecule (in nanometers) with drift correction applied. If no drift correction was applied to this data then Xc= X.</td></tr><tr><td style="">Yc</td><td style="">The Y position of the centroid of the molecule (in nanometers) with drift correction applied. If no drift correction was applied to this data then Yc= Y.</td></tr><tr><td style="">Height</td><td style="">Intensity of the peak height in the detection frame (after the detection process).</td></tr><tr><td style="">Area</td><td style="">Volume under the peak. Units are intensity * pixel^2</td></tr><tr><td style="">Width</td><td style="">Geometric mean of Wx and Wy. <img src="../img/eng/moleculedetection_batch_storm_list_text_table_01.png" height="12.5"></td></tr><tr><td style="">Phi</td><td style="">The Angle of the molecule. This is the axial angle for 2D and distance from Z calibration curve in nm in Wx, Wy space for 3D).</td></tr><tr><td style="">Ax</td><td style="">Axial ratio of Wy/Wx.</td></tr><tr><td style="">BG</td><td style="">The local background for the molecule.</td></tr><tr><td style="">I</td><td style="">Accumulated intensity.</td></tr><tr><td style="">Frame</td><td style="">The sequential frame number where the molecule was first detected.</td></tr><tr><td style="">Length</td><td style="">The number of consecutive frames the molecule was detected.</td></tr><tr><td style="">Index</td><td style="">Used in individual frame localization records only. Contains the index of corresponding linked molecule record.</td></tr><tr><td style="">Link</td><td style="">Index of localization in the molecule list of the frame pointed to by Frame field or -1 indicating the end of the trace.</td></tr><tr><td style="">Valid</td><td style="">For internal use only.</td></tr><tr><td style="">Z</td><td style="">The Z coordinate of the molecule in nanometers (origin is the cover glass).</td></tr><tr><td style="">Zc</td><td style="">The Z position of the molecule (in nanometers) with drift correction applied. If no drift correction was applied to this data then Zc= Z.</td></tr><tr><td style="">Photons</td><td style="">The total number of photons received from molecule across its entire trace length. This number is calculated using current (at the time of calculation) photons per count value.</td></tr><tr><td style="">Lateral Localization Accuracy</td><td style="">XY localization accuracy calculated using Thompson formula based on the number of photons.</td></tr><tr><td style="">Xw</td><td style="">X coordinate after XY warp transformation to compensate for chromatic aberration.</td></tr><tr><td style="">Xwc</td><td style="">X coordinate after XY warp transformation and drift correction.</td></tr><tr><td style="">Yw</td><td style="">Y coordinate after XY warp transformation to compensate for chromatic aberration.</td></tr><tr><td style="">Ywc</td><td style="">Y coordinate after XY warp transformation and drift correction.</td></tr><tr><td style="">Zw</td><td style="">Z coordinate after chromatic aberration correction Z offset has been applied.</td></tr><tr><td style="">Zwc</td><td style="">Z coordinate after chromatic aberration correction Z offset and drift correction have been applied.</td></tr></tbody></table></div></div><br class="table-break"><p>The following image illustrates the scheme used to link multiple localizations from adjacent frames into single molecule record.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_batch_storm_list_text_table_02.png" title="" data-title="Molecule list with trace traversing structure. "><img class="img-responsive" src="../img/eng/moleculedetection_batch_storm_list_text_table_02.png" alt="../img/eng/moleculedetection_batch_storm_list_text_table_02.png image"></a><p class="title"><b>Figure&nbsp;1316.&nbsp;Molecule list with trace traversing structure.</b></p></div></div><p>Molecule list with trace traversing presents the molecule information rearranged for easy trace following. It is generally ordered by the master molecule list but the individual frame localization records are inserted immediately following the corresponding molecule record. Molecules with trace length of N will have N+1 records (master and N frames). For consistency molecules with trace length of 1 will have 2 identical records (master and one frame).</p><div class="table"><a name="d0e123154"></a><p class="title"><b>Table&nbsp;18.&nbsp;Example of molecule records with trace length of 1. Mol[124939] count[1].</b></p><div class="table-contents"><table summary="Example of molecule records with trace length of 1. Mol[124939] count[1]." style="border-collapse: collapse;"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th style="" align="center">X</th><th style="" align="center">Y</th><th style="" align="center">Xc</th><th style="" align="center">Yc</th><th style="" align="center">...</th><th style="" align="center">&nbsp;</th></tr></thead><tbody><tr><td style="">111.21791</td><td style="">189.36948</td><td style="">111.70292</td><td style="">189.78879</td><td style="">...</td><td style="">(master)</td></tr><tr><td style="">111.21791</td><td style="">189.36946</td><td style="">111.21791</td><td style="">189.36946</td><td style="">...</td><td style="">(frame 1)</td></tr></tbody></table></div></div><br class="table-break"><div class="table"><a name="d0e123198"></a><p class="title"><b>Table&nbsp;19.&nbsp;Example of molecule record with trace length longer than 1. Mol[124944] count[3]</b></p><div class="table-contents"><table summary="Example of molecule record with trace length longer than 1. Mol[124944] count[3]" style="border-collapse: collapse;"><colgroup><col><col><col><col><col><col></colgroup><thead><tr><th style="" align="center">X</th><th style="" align="center">Y</th><th style="" align="center">Xc</th><th style="" align="center">Yc</th><th style="" align="center">...</th><th style="" align="center">&nbsp;</th></tr></thead><tbody><tr><td style="">206.68843</td><td style="">31.06892</td><td style="">207.17416</td><td style="">31.48837</td><td style="">...</td><td style="">(master)</td></tr><tr><td style="">206.67001</td><td style="">31.07309</td><td style="">206.67001</td><td style="">31.07309</td><td style="">...</td><td style="">(frame 1)</td></tr><tr><td style="">206.66777</td><td style="">31.00289</td><td style="">206.66777</td><td style="">31.00289</td><td style="">...</td><td style="">(frame 2)</td></tr><tr><td style="">206.72476</td><td style="">31.13095</td><td style="">206.72476</td><td style="">31.13095</td><td style="">...</td><td style="">(frame 3)</td></tr></tbody></table></div></div><br class="table-break"></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.roi.statistics"></a>ROI Statistics <button class="xmlid" data-clipboard-text="id|molecule.reference.roi.statisticsx">üîó</button></h4></div></div></div><p>If any ROI(s) with molecules inside of them are present in your image, switch to the <span class="guilabel">ROI Statistics</span> tab to view the statistics per each ROI and for the whole image.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_dialog.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_dialog.png" alt="../img/eng/moleculedetection_roi_statistics_dialog.png image"></a><p class="title"><b>Figure&nbsp;1317.&nbsp;</b></p></div></div><div class="variablelist"><p class="title"><b>ROI Statistics Table</b></p><p>The table summarizes the number of molecules in the image and in all ROIs. If multiple ROIs are selected, their features are shown per each ROI (separate column). More features such as the area, perimeter, center of mass and Niquist are calculated as well. To easily switch the units used in the statistics, click on the <span class="guibutton">[px] &lt;-&gt; [¬µm]</span> button in the top left corner of the table.</p><p>The first graph shows the <span class="guilabel">Photon count chart</span> which represents the peak intensity histogram in the ROI.</p><p>The second graph shows the <span class="guilabel">Lateral localization chart</span> representing the <span class="guilabel">Width</span> of the Gaussian peak.</p><p>The third graph shows the <span class="guilabel">Ripley graph and cumulative histogram</span>. Select one of the three graphs for molecule population - Ripley's K function (<span class="emphasis"><em>K</em></span>), Ripley's H function (<span class="emphasis"><em>H</em></span>), or <span class="emphasis"><em>CHD</em></span> and set the <span class="guilabel">Max search radius</span> and <span class="guilabel">Border correction</span>. All the three graphs use the XY distance between molecules as the horizontal axis.</p><dl><div class="varlistentry"><span class="term">CHD (Cumulative Histogram of Distances)</span> <p>For any given distance the value of the function is the number of molecule pairs in the ROI molecule population with distance equal or smaller to the given distance. Formal definition:</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_chd_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_chd_01.png" alt="../img/eng/moleculedetection_roi_statistics_chd_01.png image"></a><p class="title"><b>Figure&nbsp;1318.&nbsp;</b></p></div></div><p>where <span class="emphasis"><em>I</em></span> <sub>r</sub> <span class="emphasis"><em>I</em></span> <sub>r</sub> is the indicator function defined as</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_chd_02.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_chd_02.png" alt="../img/eng/moleculedetection_roi_statistics_chd_02.png image"></a><p class="title"><b>Figure&nbsp;1319.&nbsp;</b></p></div></div><p><span class="emphasis"><em>nn</em></span> is the number of points</p><p><span class="emphasis"><em>rr</em></span> is the max neighborhood search distance around any given point</p><p><span class="emphasis"><em>d</em></span> <sub>ij</sub> is the distance between points i and j</p></div><div class="varlistentry"><span class="term">Ripley‚Äôs K function</span> <p>Ripley‚Äôs K function is similar to CHD except it is scaled by factor:</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysk_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysk_01.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysk_01.png image"></a><p class="title"><b>Figure&nbsp;1320.&nbsp;</b></p></div></div><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysk_02.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysk_02.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysk_02.png image"></a><p class="title"><b>Figure&nbsp;1321.&nbsp;</b></p></div></div><p>where Œª is average density. In this form Ripley‚Äôs K function estimates the expected number of additional points within distance <span class="emphasis"><em>rr</em></span> around a randomly picked point normalized per unit of density. <span class="emphasis"><em>ŒªŒª</em></span> is the average density of the ROI population</p><p><span class="emphasis"><em>Œª = n/a</em></span></p><p>where <span class="emphasis"><em>aa</em></span> is the ROI area.</p><p>Ripley‚Äôs K function is useful to explore cluster topology. When molecules form clusters, Ripley‚Äôs K function forms horizontal plateaus and steep rises (staircase look). For example, in the simplest case of two clusters, Ripley‚Äôs K function has one horizontal plateau.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysk_plateau.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysk_plateau.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysk_plateau.png image"></a><p class="title"><b>Figure&nbsp;1322.&nbsp;</b></p></div></div><p>The horizontal axis of Ripley‚Äôs K function is the distance between molecules in a given pair. The vertical axis is proportional to the number of pairs in the population with distance not exceeding given. The first vertical rise on the left side comes from a number of close by neighbor molecules within each cluster. The position of the left edge of the horizontal plateau implies the size of clusters. As the distance increases further, the number of matching pairs does not increase until the distance reaches the distance between clusters. At that point the count begins to rise again, because larger distances between molecules of different clusters begin to contribute. Therefore the right edge of horizontal plateau suggests the inter cluster distance. Mouse cursor position in graph units is displayed in the bottom right corner as the mouse hovers over the graph area.</p></div><div class="varlistentry"><span class="term">Ripley‚Äôs H function</span> <p>Ripley‚Äôs H function can be defined in terms of Ripley‚Äôs K function.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysh_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysh_01.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysh_01.png image"></a><p class="title"><b>Figure&nbsp;1323.&nbsp;</b></p></div></div><p>When points are randomly distributed, K function approximately follows the area of a circle function.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysh_02.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysh_02.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysh_02.png image"></a><p class="title"><b>Figure&nbsp;1324.&nbsp;</b></p></div></div><p>The K function exceeds area function, when data points form clusters on a given scale. Conversely, the K function falls below the area function, when data points disperse (or form voids) on a given scale. The H function makes detection of clusters (or lack thereof) easier than the K function, because its value remains 0 under CSR (complete spatial randomness) condition. When the data points exhibit clustering, the H function becomes positive and forms a visible peak. When the data points are distributed uniformly, the H function becomes negative.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_ripleysh_03.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_ripleysh_03.png" alt="../img/eng/moleculedetection_roi_statistics_ripleysh_03.png image"></a><p class="title"><b>Figure&nbsp;1325.&nbsp;</b></p></div></div><p>All three cluster analysis functions quickly become computationally expensive as ROI population grows. Calculation time is greatly affected by other options such as maximum neighborhood search radius and edge effect correction method discussed below.</p><p><span class="guilabel">Max search radius</span> edit box below the function selection buttons displays and adjusts the max neighborhood search radius. The button on its right side provides (and cycles through) three choices for distance units: nanometers (nm), micrometers (¬µm), and pixels. Pixels correspond to the original camera pixels (typically 160 nm). The largest supported search radius is 16 pixels or approximately 2.5 micrometers. The units apply to both the max search distance and the graph. When units change, the value of the <span class="guilabel">Max search radius</span> edit box automatically converts. The choice of units does not affect the length of calculation, but, when changed, commences the new calculation rather than converting results of the previous one. Reducing the <span class="guilabel">Max search radius</span> can greatly reduce the length of calculation.</p><p><span class="guilabel">Border correction</span> is an edge effect correction attempting to compensate for the lack of neighboring points when the search is conducted near the ROI border. The circular search neighborhood then partially falls outside of the ROI. <span class="guilabel">None</span> simply skips the correction. This is the fastest method. <span class="guilabel">Perimeter</span> implements the popular correction method based on the fraction of circle perimeter within the ROI. Each measured distance carries a weight factor. When the circle around point <span class="emphasis"><em>i</em></span> with radius equal to distance to point <span class="emphasis"><em>j</em></span> is completely contained in the ROI the weight factor is 1. Otherwise the weight factor is equal to the fraction of the circle perimeter within ROI and is less than 1.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_border_01.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_border_01.png" alt="../img/eng/moleculedetection_roi_statistics_border_01.png image"></a><p class="title"><b>Figure&nbsp;1326.&nbsp;</b></p></div></div><p>During Ripley‚Äôs K function calculation contribution of each distance is divided by its weight factor, thus increasing when weight factor is less than 1 and therefore compensating for the possibly reduced neighbor count.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_border_02.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_border_02.png" alt="../img/eng/moleculedetection_roi_statistics_border_02.png image"></a><p class="title"><b>Figure&nbsp;1327.&nbsp;</b></p></div></div><p>Perimeter based edge effect correction is the most computationally expensive. Switching to a faster method, if acceptable, can greatly reduce calculation time.</p><p><span class="guilabel">Border correction</span> method simply counts neighbor points outside of ROI that fall within max search radius or ROI points, but does not search their neighborhoods. All weight coefficients remain 1.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_border_03.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_border_03.png" alt="../img/eng/moleculedetection_roi_statistics_border_03.png image"></a><p class="title"><b>Figure&nbsp;1328.&nbsp;</b></p></div></div><p>Edge effect correction applies to CDH and H(r) functions in a manner similar to K(r) shown above.</p><p>When molecule data has multiple channels, cluster analysis can be performed across channels. In other words the distances are measured in one direction: from molecules in origin subset to molecules in target subset. These subsets can be defined as all molecules or molecules belonging to one of the channels. All combinations are possible. For example a two channel data set provides the following options:</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_roi_statistics_border_04.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_roi_statistics_border_04.png" alt="../img/eng/moleculedetection_roi_statistics_border_04.png image"></a><p class="title"><b>Figure&nbsp;1329.&nbsp;</b></p></div></div></div></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.xy.warp"></a>XY Warp<button class="xmlid" data-clipboard-text="id|molecule.reference.xy.warpx">üîó</button></h4></div></div></div><p>This button performs XY Warp calibration using the information extracted from the multi reporter Z Calibration file. This button is enabled only when such file is loaded and STORM analyzed. Since 3D Cylindrical lens can affect chromatic aberration and separate calibration is recommended for each combination of objective, reporter wavelength, and cylindrical lens. To calibrate 2D XY Warp acquire Z Calibration file without cylindrical lens in optical path. 3D XY Warp calibration can be achieved with regular Z Calibration file. Single multi reporter calibration file produces several calibrations at once (one for each wavelength except the shortest one, which serves as a base and does not require calibration). XY Warp is applied to molecule coordinates to compensate for the effects of chromatic aberration. Molecules with longer reporter wavelength can be optionally repositioned to locations where they would be likely to appear. This adjustment is necessary to correctly perceive the relative position between molecules reported in different wavelengths. Unsuitable beads can be manually excluded from the warp calibration by assigning multi ROIs around them.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.zcalibration"></a>Z-Calibration<button class="xmlid" data-clipboard-text="id|molecule.reference.zcalibrationx">üîó</button></h4></div></div></div><p>Z Calibration is performed by analyzing a Z-Series dataset to determine the width and orientation of all identified molecules. Each Z Calibration pertains to an objective and an excitation wavelength. Objective name is displayed in the title of the dialog. Excitation wavelengths of different channels are presented as tabs in the upper half of the dialog. When data set (ND2 file) is loaded Z Calibration dialog displays only calibrations linked to the objective and the reporter wavelengths pertaining to the data. To view all known Z Calibrations maintained by the system (for other objectives and wavelengths) close current data set or restart the software and visit Z Calibration dialog when no data set is loaded. In this case two extra buttons allow iterating through the list of calibrated objectives. Individual reporter calibrations can be accessed via tabs named and colored after their respective wavelength. Additionally in this mode the <span class="guibutton">Load</span> and <span class="guibutton">Save</span> buttons at the bottom are renamed into Restore and Backup respectively and perform a different function that will be described below.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_z_calibration_dialog.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_z_calibration_dialog.png" alt="../img/eng/moleculedetection_z_calibration_dialog.png image"></a><p class="title"><b>Figure&nbsp;1330.&nbsp;</b></p></div></div><div class="variablelist"><dl><div class="varlistentry"><span class="term">Start/End</span> <p>These values specify the lower and upper Z limit of the calibrated dataset. Typically, these values will be smaller (by absolute value) than the top and bottom of the Z Stack used during the calibration process. These values are automatically updated during Auto Calibration.</p></div><div class="varlistentry"><span class="term">Step</span> <p>This value specifies the resolution of the calculated Wx/Wy calibration curve. Typically, data points that make the curve are spaced 1 nm (in Z direction) apart from each other.</p></div><div class="varlistentry"><span class="term">Tolerance</span> <p>The tolerance value specifies how far from the <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_01.png" height="12.5"> vs. <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_02.png" height="12.5"> curve a molecule can be and still be considered valid. Any molecules that are further from the curve than the specified tolerance distance will be placed into a special channel called <span class="quote">‚Äú<span class="quote">Z Rejected</span>‚Äù</span>. Z Rejected Molecules can optionally be displayed. The Default tolerance value is 1.5 nm.</p></div><div class="varlistentry"><span class="term">Parabola Coefficients Values</span> <p>There are two ways to determine the Wx and Wy calibration curves. The first method is for the software to capture a special Z series of a calibration slide (sub-resolution beads mounted to the cover glass). The elongation of every molecule is measured and the software automatically generates the curves.</p><p>The second method is to use the data collected from the Z-Series dataset and calculate the calibration outside of <span class="productname">NIS-Elements</span> using third party analysis software. The coefficients that were calculated outside of <span class="productname">NIS-Elements</span> can then be input into the parabola coefficients for Wx and Wy.</p><p>The defocusing curve formula is:</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_z_calibration_dialog_formula_12.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_z_calibration_dialog_formula_12.png" alt="../img/eng/moleculedetection_z_calibration_dialog_formula_12.png image"></a><p class="title"><b>Figure&nbsp;1331.&nbsp;</b></p></div></div><p><img src="../img/eng/moleculedetection_z_calibration_dialog_formula_09.png" height="12.5"> is the lowest point in each graph <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_03.png" height="12.5">or <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_04.png" height="12.5">. <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_05.png" height="12.5"> and <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_06.png" height="12.5">should be approximately the same. If they are not, one parabola is positioned higher than the other. It means points focus tighter in one direction than in the other likely due to spherical aberration.</p><p><img src="../img/eng/moleculedetection_z_calibration_dialog_formula_07.png" height="12.5"> is the focal depth of the microscope. Ideally it should also be the same between X and Y. Calibration fitting algorithm restricts it to stay below (and including) 5000.</p><p><img src="../img/eng/moleculedetection_z_calibration_dialog_formula_08.png" height="12.5"> is the relative to focal plane Z position where each curve focused the tightest. Ideally the values for X and Y should be the same by absolute value but with opposite signs (X negative and Y positive). This would mean that calibration is perfectly symmetrical around focal plane.</p><p><img src="../img/eng/moleculedetection_z_calibration_dialog_formula_09.png" height="12.5"> and <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_08.png" height="12.5"> values can be directly found in the <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_03.png" height="12.5"> and <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_10.png" height="12.5"> vs. <img src="../img/eng/moleculedetection_z_calibration_dialog_formula_11.png" height="12.5"> graph as illustrated below.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_z_calibration_dialog_graph_parabola.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_z_calibration_dialog_graph_parabola.png" alt="../img/eng/moleculedetection_z_calibration_dialog_graph_parabola.png image"></a><p class="title"><b>Figure&nbsp;1332.&nbsp;</b></p></div></div><p><span class="quote">‚Äú<span class="quote">A</span>‚Äù</span>, <span class="quote">‚Äú<span class="quote">B</span>‚Äù</span>, <span class="quote">‚Äú<span class="quote">C</span>‚Äù</span>, and <span class="quote">‚Äú<span class="quote">D</span>‚Äù</span> are higher order polynomial coefficients. A is the coefficient of the third order. B is the coefficient of the fourth order, and so on. Ideally all coefficients (A, B, C and D) should be 0. Typically coefficients A and B alone produce close enough approximation curve, so C and D are normally kept at 0 even in practice. There is an .ini file setting that removes the C and D constraint to deal with difficult cases. It's called <span class="quote">‚Äú<span class="quote">z calibration auto calib higher order corrections</span>‚Äù</span>. It is difficult to judge the quality of calibration by just looking at the values of these coefficients.</p><div class="variablelist"><dl><div class="varlistentry"><span class="term">Auto Calibrate</span> <p>This button automates the process of creating the Z calibration curves. It requires a Z-Calibration molecule list present (loaded or analyzed). Holding <span class="keycap"><strong>Ctrl</strong></span> while pressing Auto Calibration button causes the algorithm to ignore high density cluster localizations that may lead to peak overlap in out of focus frames. Ignored localizations are reassigned to Z Rejected channel that is otherwise not used with Z Calibration data.</p></div><div class="varlistentry"><span class="term">Load/Save</span> <p>Z Calibrations can be saved to a text file. These files can then be opened and applied to other 3D STORM datasets. These buttons are only available when ND2 data set is loaded. They work with a subset of calibrations pertaining to current data set. These calibrations may be different from the calibrations maintained by the system for newly acquired data sets. Calibrations loaded in this manner are called <span class="quote">‚Äú<span class="quote">foreign</span>‚Äù</span>. They become active (in effect for the subsequent 3D STORM analysis) and temporary override system or embedded nd2 file calibrations. They do not overwrite system calibration, which goes back in effect as soon as current nd2 file is closed. Foreign calibration can be permanently embedded into an nd2 file if at any point after foreign calibration is loaded the nd2 file is saved.</p></div><div class="varlistentry"><span class="term">Graph</span> <p>This button displays the menu with options for various graphs that visualize calibration curves and raw data and help evaluate results of current Z Calibration. There are eight types of Graphs available.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/moleculedetection_z_calibration_dialog_graph_button.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/moleculedetection_z_calibration_dialog_graph_button.png" alt="../img/eng/moleculedetection_z_calibration_dialog_graph_button.png image"></a><p class="title"><b>Figure&nbsp;1333.&nbsp;</b></p></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p><span class="guilabel">Wx-Wy vs. Z</span> ‚Äì This graph shows the Wx and Wy calibration curves (cyan and yellow respectively) and the identified molecule‚Äôs Wx (red) and Wy (blue) values that pertain to currently selected in Z Calibration dialog channel tab. Generally the number of raw data points is limited to 3000. To display all points hold the <span class="keycap"><strong>Ctrl</strong></span> key while selecting the menu item.</p></li><li class="listitem"><p><span class="guilabel">Ax Ratio vs. Z</span> -This graph will show the ratio of Wy/Wx on the Y axis and Z on the X axis. It also shows the identified molecule‚Äôs Wy/Wx ratio values (in blue). Generally the number of raw data points is limited to 3000. To display all points from the currently selected channel hold the <span class="keycap"><strong>Ctrl</strong></span> key while selecting the menu item.</p></li><li class="listitem"><p><span class="guilabel">Wx vs. Wy</span> ‚Äì shows the plot of Wx vs. Wy for the calibrated curves (in green) and of the individual localizations from current channel (in blue). Generally the number of raw data points is limited to 3000. To display all points hold the <span class="keycap"><strong>Ctrl</strong></span> key while selecting the menu item.</p><p>Holding the <span class="keycap"><strong>Shift</strong></span> key while selecting this graph‚Äôs menu item displays the Z Rejected points in addition to the points from the currently selected channel tab. This helps checking how well the raw data follow the current calibration. Z Rejected molecules can be further categorized into those too far from the curve (yellow) and those with Z position beyond the calibration range (red).</p></li><li class="listitem"><p><span class="guilabel">Wx-Wy vs. Z</span> (Frame Average) ‚Äì this will show the same graph as above (#1) but only show the average Wx and Wy position per frame of the identified molecules. This graph is only available immediately after Z Calibration.</p></li><li class="listitem"><p><span class="guilabel">Ax vs. Z</span> (Frame Average) - This will show the same graph as above (#2) but only display the average Ax (Wy/Wx ratio) per frame for the molecules. This graph is only available immediately after Z Calibration.</p></li><li class="listitem"><p><span class="guilabel">Wx vs. Wy</span> (Frame Average) ‚Äì This will show the same graph as above (#3) but only display the average Wx and average Wy per frame for the identified molecules. This graph is only available immediately after Z Calibration.</p></li><li class="listitem"><p><span class="guilabel">Axial Ratio vs. Period</span> ‚Äì This graph is useful for evaluating Z calibration data before performing <span class="guilabel">Auto Calibration</span> because it does not rely on any (previous or current) calibration. It simply displays the raw data points without any curve graphs. This graph is only available when Z calibration data is loaded and STORM analyzed. By default it displays up to 3000 points from the currently selected channel.</p><p>To display all points from the current channel hold <span class="keycap"><strong>Ctrl</strong></span> while selecting the menu item. Sometimes the data contains outliers that affect scaling. To exclude outliers and see the data that more closely resembles the filtered set used for actual calibration, hold the <span class="keycap"><strong>Alt</strong></span> key while selecting this graph‚Äôs menu item. This option picks only 80% of points from the middle of the distribution in every frame and rejects outliers.</p><p>To observe the effects of chromatic aberration on multichannel data hold the <span class="keycap"><strong>Shift</strong></span> key while selecting the menu item. This displays all channels at once.</p><p>The channel colors used in this graph match the pseudo colors of the calibration data set.</p></li><li class="listitem"><p><span class="guilabel">Axial Ratio vs. Period</span> (frame average) ‚Äì This graph displays almost the same data as the one above (#7). The only difference it calculates the average for every frame and displays it as one point per frame. It has all the same options (<span class="keycap"><strong>Shift</strong></span> for multi channel, <span class="keycap"><strong>Ctrl</strong></span> for all points rather than 3000, <span class="keycap"><strong>Alt</strong></span> for skipping outliers). This is the most useful graph to evaluate raw Z calibration data before actual calibration.</p><p>The software keeps track of multiple Z calibrations as they pertain to objectives with which they were acquired. During analysis the objective information is retrieved from the metadata and used to apply the correct calibration curves. If the calibration for data set objective is unavailable the software displays the warning and applies the default calibration. Similarly to Objective name software links calibration to reporter wavelengths and warns if calibration curve for any of the dataset wavelength is missing.</p><p>The objective name pertaining to current Z Calibration is displayed in the title bar of the <span class="guilabel">Z Calibration</span> dialog.</p><p>Calibrations for different wavelengths are affected by chromatic aberration. With a cylindrical lens in the optical path a given axial ratio of localizations happens at different Z positions for different wavelengths. Conversely a given Z position imaging with different wavelengths produces localizations with different axial ratios. When multiple wavelength calibrations are acquired and analyzed together, the software extracts axial chromatic shifts and maintains them along with calibration curves. When a newly acquired data set (acquired with the same objective and reporter wavelengths) is loaded and analyzed, the calibrated chromatic offsets are also applied to Z positions. The channel with the shortest reporter wavelength is used as a reference for chromatic aberration offsets.</p><p>All graph dialogs have pop-up menu options to change the color of the background and grid lines. These colors are shared by all N-STORM analysis module graph dialogs and persist across <span class="productname">NIS-Elements</span> sessions.</p><p>Similarly all graph dialogs share the ability to zoom by the mouse scroll wheel around the current cursor position and to pan the graph with a mouse drag operation.</p><p>Graph image as well as numerical data can be transferred to a third party application via Windows Clipboard or exported into an image or text files on a disk. Both options appear at the bottom of the right click pop-up menu.</p><p>All Z Calibration dialog buttons provide tooltip reminders.</p></li></ol></div></div></dl></div></div></dl></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.zstack.alignment"></a>Z-Stack Alignment<button class="xmlid" data-clipboard-text="id|molecule.reference.zstack.alignmentx">üîó</button></h4></div></div></div><p>Some Automatic layer alignment algorithms involve examining and matching multiple ROIs. These ROIs can be defined manually or generated automatically. The mix of both is also possible. Click on the drop-down arrow next to the <img src="../res/base/tracking.png" height="12.5"> Start correlation button to open the <span class="guilabel">Z-Stack Alignment Options</span>.</p><div class="variablelist"><dl><div class="varlistentry"><span class="term">ROI Source</span> <p>This section defines the set of ROIs to be used. Automatically generated ROIs are arranged in a grid with definable dimensions (<span class="guilabel">Grid</span>). The Mix Manual and Auto generated ROIs button controls the mixing behavior. When the button is unchecked (<img src="../res/base/roi_user.png" height="12.5">)and manually defined ROIs exist, no auto generated ROIs are added. When the button is checked (<img src="../res/base/roi_default.png" height="12.5">) or no manually defined ROIs exist, the grid of ROIs is generated according to grid dimensions. The left field is the number of columns and the right field is the number of rows.</p></div><div class="varlistentry"><span class="term">ROI Filters</span> <p>Not all generated ROIs are good for layer alignment. Only ROIs that pass through the ROI filter are considered.</p><p>First ROI filter is by the molecule count <img src="../res/base/suma_min.png" height="12.5">. ROIs with relatively small number of molecules are discarded. The <span class="guilabel">Min Count</span> threshold is defined as a percentage of the maximum single ROI molecule count among the ROI population. The button toggles the filter on and off. The filter is enabled by default.</p><p>The second filter is the Maximum average Nearest Neighbor distance filter (<img src="../res/base/nn_max.png" height="12.5">). If applied, it removes ROIs with average nearest neighbor distance greater than the specified percentage of the maximum average nearest neighbor distance if the molecules were evenly and randomly distributed throughout the ROI area without forming any structure or clusters. In practice this filter is not very useful because, with STORM, individual molecules get localized more than once. Even when fluorophores are evenly distributed, their localizations form tight clusters which significantly drives average nearest neighbor distance down, thus making ROIs that lack structure falsely identified as those containing a structure. This filter is available only in the <span class="guibutton">Advanced</span> mode and is disabled by default.</p></div><div class="varlistentry"><span class="term">Autocorrelation density map</span> <p>This group of controls provides several options that affect the autocorrelation algorithm input. Autocorrelation expects two similar signals. As it is used for layer alignment of localization data the signals are 2D density maps or histograms with bin values representing molecule counts falling within each spatial bin.</p><p>Z layer intersection (<img src="../res/base/layers_overlap.png" height="12.5">)or union (<img src="../res/base/layers_union.png" height="12.5">)choice affects the Z position filtering during histogram build. Intersection is chosen by default.</p><p>Another option (<img src="../res/base/roi_join.png" height="12.5">)is to merge ROIs for single autocorrelation and single offset result or (<img src="../res/base/separate_autocorrelation.png" height="12.5">) to perform separate autocorrelation for each ROI and then filter/average multiple results.</p><p>Outlier histogram bins can be optionally trimmed to avoid spurious autocorrelation offsets caused by occasional high density clusters. This option is enabled by default.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/showcontrol.moleculescontrol_histogram_sigma.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/showcontrol.moleculescontrol_histogram_sigma.png" alt="../img/eng/showcontrol.moleculescontrol_histogram_sigma.png image"></a><p class="title"><b>Figure&nbsp;1334.&nbsp;<img src="../res/base/sigma_histogram.png" height="12.5"></b></p></div></div><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/showcontrol.moleculescontrol_histogram_sigma_trim.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/showcontrol.moleculescontrol_histogram_sigma_trim.png" alt="../img/eng/showcontrol.moleculescontrol_histogram_sigma_trim.png image"></a><p class="title"><b>Figure&nbsp;1335.&nbsp;<img src="../res/base/sigma_histogram_trim.png" height="12.5"></b></p></div></div></div><div class="varlistentry"><span class="term">Autocorrelation offset filter</span> <p>This filter is shown in the <span class="guibutton">Advanced</span> mode only. It is applicable to multi ROI alignment workflows that do not merge multiple ROIs (<img src="../res/base/separate_autocorrelation.png" height="12.5">). This produces multiple offset results for a given pair of layers. The Offset Filter (<img src="../res/base/clusters_color.png" height="12.5">) checks how well multiple Cubes agree on the XY offset. DBSCAN algorithm is used to find a cluster that pertains to the subset of cubes that well agree with each other. Offsets obtained from other cubes are then ignored as outliers. The good offsets are averaged. To troubleshoot difficult layer alignment the <span class="guilabel">Test Mode</span> is available via the <img src="../res/base/settings_hammer.png" height="12.5"> button. In the <span class="guilabel">Test Mode</span> intermediate data from each cube autocorrelation operation is available for close examination and alignment offsets are not applied to layers.</p></div></dl></div></div><div class="section page"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.layers"></a>Z-Stacked STORM<button class="xmlid" data-clipboard-text="id|molecule.reference.layersx">üîó</button></h4></div></div></div><div class="toc"><dl><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s11s1">Overview</a></span></dt><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s11s2">File naming convention</a></span></dt><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s11s3">Z stack STORM analysis</a></span></dt><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s11s4">Working with Z stack STORM molecule data</a></span></dt><dt><span class="section"><a href="molecule.reference.html#p2c20s2s3s11s5">Managing N-STORM Z Stack (Layers table)</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s11s1"></a>Overview<button class="xmlid" data-clipboard-text="id|p2c20s2s3s11s1x">üîó</button></h5></div></div></div><p>Typical N-STORM Z calibration range is 800 nm (from 400 nm below to 400 nm above focal plane). Z stacking feature is available to overcome the 800 nm depth limit and image larger volumes. N-STORM acquisition module captures multiple slices along Z axis. Each slice covers the 800 nm Z range. Each slice raw data is stored in a separate ND2 file. To even out photo bleaching during acquisition, the volume can be acquired by spending shorter time at each slice while visiting each slice multiple times. In Z stacked STORM terminology the slices are also called <span class="quote">‚Äú<span class="quote">layers</span>‚Äù</span> and a set of unique layers is called a <span class="quote">‚Äú<span class="quote">pass</span>‚Äù</span>. The entire Z stacked STORM data set consists of one or more passes. Similarly to regular (non-Z stacked) 3D storm data, each layer has its Z position defined as the distance between the cover glass and the focal plane. The actual position of the focal plane is affected by spherical aberration. It is calculated by the software from the microscope Z mechanism displacement measured and stored in the ND2 file metadata. The displacement focal plane position (not the corrected one) is the one associated with each layer and displayed in the software.</p><p>Layers may overlap in the Z direction to aid alignment between adjacent layers and between passes. When they do, the focal plane positions of adjacent layers differ by less than the calibration range. Alignment is necessary to compensate for the drift during acquisition.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s11s2"></a>File naming convention<button class="xmlid" data-clipboard-text="id|p2c20s2s3s11s2x">üîó</button></h5></div></div></div><p>Z stack STORM ND2 files follow a file naming convention to preserve layer and pass numbering order. Each name is made of:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Base file name common to all files.</p></li><li class="listitem"><p>Pass number suffix that starts with letter P followed by two digit pass number (starting with 01).</p></li><li class="listitem"><p>Layer number suffix that starts with letter L followed by three digit layer number (starting with 001).</p></li><li class="listitem"><p>.nd2 extension.</p></li></ol></div><div class="example"><a name="d0e123875"></a><p class="title"><b>Example&nbsp;16.&nbsp;Example of two passes three layers Z stack with base name "Test_":</b></p><div class="example-contents"><p>Test_P01_L001.nd2</p><p>Test_P01_L002.nd2</p><p>Test_P01_L003.nd2</p><p>Test_P02_L001.nd2</p><p>Test_P02_L002.nd2</p><p>Test_P02_L003.nd2</p></div></div><br class="example-break"></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s11s3"></a>Z stack STORM analysis<button class="xmlid" data-clipboard-text="id|p2c20s2s3s11s3x">üîó</button></h5></div></div></div><p>Similarly to the regular (non-Z stack) N-STORM workflow, ND2 files need to be analyzed to produce molecule lists that can later be rendered as super resolution images. Although each ND2 file can be analyzed individually, N-STORM Analysis module provides a simplified batch setup and processing to streamline the analysis of large amounts of data often associated with the Z stack STORM. Multiple ND2 files can be dragged and dropped onto the Batch window from <span class="guilabel">Windows Explorer</span>.</p><p>The molecule list files produced by batch analysis are named after their ND2 predecessors. The pass and layer index suffixes are preserved. To continue with the ND2 naming example above the molecule list files will be named:</p><p>Test_P01_L001_list-2015-08-07-10-45-20_S01.bin</p><p>Test_P01_L002_list-2015-08-07-10-47-30_S02.bin</p><p>Test_P01_L003_list-2015-08-07-10-49-40_S03.bin</p><p>Test_P02_L001_list-2015-08-07-10-51-50_S04.bin</p><p>Test_P02_L002_list-2015-08-07-10-54-00_S05.bin</p><p>Test_P02_L003_list-2015-08-07-10-56-10_S06.bin</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s11s4"></a>Working with Z stack STORM molecule data<button class="xmlid" data-clipboard-text="id|p2c20s2s3s11s4x">üîó</button></h5></div></div></div><p>Each molecule list can be loaded individually in a traditional way. To load and merge all layers at the same time simply drag and drop all pertaining molecule list bin files from the <span class="guilabel">Windows Explorer</span> onto the main N-STORM window. Multiple files can also be selected and opened at once via <span class="guilabel">File &gt; Open</span> dialog using standard Windows (<span class="keycap"><strong>Ctrl</strong></span> and <span class="keycap"><strong>Shift</strong></span>) keys for multi file selection. Loading progress feedback is displayed in the window title.</p><p>One ND2 file can be loaded before multi file drag and drop operation or as a part of it. Multiple ND2 files and other non binary molecule list files are ignored if present among binary molecule lists drag and drop file selection. Skipping some of the layers (by excluding them from drag and drop selection) during load is acceptable.</p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="p2c20s2s3s11s5"></a>Managing N-STORM Z Stack (Layers table)<button class="xmlid" data-clipboard-text="id|p2c20s2s3s11s5x">üîó</button></h5></div></div></div><p>The layers table in the <span class="guilabel">Molecule Options</span> dialog has the following main functions.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>Displaying layer information</p></li><li class="listitem"><p>Selecting layer subsets for various operations</p></li><li class="listitem"><p>Setting up layer pseudo colors (automatically and manually)</p></li><li class="listitem"><p>Adjusting (ŒîX, ŒîY, ŒîZ) layer offsets to align adjacent layers and passes (automatically and manually)</p></li><li class="listitem"><p>Toggling alignment offsets in rendered image</p></li><li class="listitem"><p>Multi ROI associated with layer subsets</p></li><li class="listitem"><p>Toggling between pseudo colors by layer and by channel</p></li></ul></div><p>Layer information is displayed in a grid where each row represents a single layer.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="molecule.reference.faq"></a>Frequently Asked Questions<button class="xmlid" data-clipboard-text="id|molecule.reference.faqx">üîó</button></h4></div></div></div><p></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Why do the molecules look dark when I am in Normalized Gaussian mode?</p><p>The most common cause is that the display properties for Normalized Gaussian are not properly set. It is common that molecules look bright when the image is near 1:1 because of the large concentration of molecules. However, when zooming into the image, they can tend to appear darker. Adjust the Min and Max Threshold in the Advanced Gaussian settings of the <span class="guilabel">STORM Display Options</span> dialog.</p></li><li class="listitem"><p>Why do I not see all of the molecules?</p><p>It is common that not all molecules will be displayed. The lower right hand Status bar will show how many molecules are currently displayed vs. the total number of molecules identified. Most likely, there are some filter settings in the <span class="guilabel">Filter</span> dialog that are currently selected. Note that some filters (like photon count and trace length) are in effect all the time and cannot be disabled. However, they can be relaxed to include a wide range of values.</p></li><li class="listitem"><p>How do I apply a Z Calibration to an already processed dataset?</p><p>After calibration, save the calibration settings to a text file (in the <span class="guilabel">3D Settings</span> dialog). Open the processed dataset, and load this text file. Then perform STORM Analysis again. See section on STORM analysis workflow for more information.</p></li><li class="listitem"><p>When I turn on <span class="quote">‚Äú<span class="quote">Mark Identified Molecules</span>‚Äù</span>, only some yellow boxes have molecules inside. Why?</p><div class="orderedlist"><ol class="orderedlist" type="a"><li class="listitem"><p>The <span class="guilabel">Rel Frame Range</span> filter was set and only molecules within that selected frame range are displayed.</p></li><li class="listitem"><p>Yellow boxes are always aligned to the low resolution image pixels. If you display drift corrected molecule positions the corresponding cross may be far outside the yellow box. In order to see it inside use uncorrected for drift coordinates.</p></li><li class="listitem"><p>There are some other filter settings that prevent the molecule inside the box to be displayed. Some filters cannot be turned off. For example minimum and maximum number of photons, and max trace length. If the number of photons per count is set incorrectly then some molecules could be pushed out of the allowable (to be displayed) range for the number of photons.</p></li><li class="listitem"><p>Yellow boxes remain on for the entire duration of the molecule trace. For example, if some molecule was first discovered in frame 1000 and remained fluorescing until frame 1005 (inclusive for the total of 6 frames) then the yellow box will be visible in all these frames. If you set your frame filter to only display molecules discovered in current frame (0 minus and 0 plus) then the corresponding cross will show up only in frame 1000 and leave empty yellow box in the remaining frames (1001 to 1005). In many cases empty yellow boxes mean that this is the time cross-section of the molecule trace and that this is not the first frame where this molecule was first discovered.</p></li><li class="listitem"><p>Some molecules are invalid. They are present in the list but they are never displayed due to various reasons. This affects the cross but not the yellow box.</p></li><li class="listitem"><p>In multi-channel files the currently selected tab channel acts as a filter. It is possible to navigate to some first after activation frame but switch to non-specific activation channel tab at the same time. Similarly one can navigate to some non-specific frame while selecting some specific activation tab. Either of these actions will leave full screen of empty yellow boxes.</p></li></ol></div><p>Mark Identified Molecule boxes are independent of Filter settings. Yellow boxes are not intended to be used with crosses or with Gaussian rendering at the same time. They are generally used as a test for the correctness of identification settings. They should be viewed superimposed on low resolution image so that user can see how many PSF peaks in raw pixel data were perceived as molecules.</p></li><li class="listitem"><p>How often does Z Calibration need to be performed?</p><p>Unless some part of the optical system changed (i.e. objective), Z Calibration only needs to be performed once.</p></li><li class="listitem"><p>How do I calculate axial widths (Wx and Wy) of a peak from its general width W and axial ratio Ax?</p><p><img src="../img/eng/moleculedetection_batch_storm_faq_01.png" height="12.5"> <img src="../img/eng/moleculedetection_batch_storm_faq_02.png" height="12.5"></p></li></ol></div></div></div><div class="footer"><a href="http://www.laboratory-imaging.com" class="footer" target="_blank">Copyright 1991-2025 Laboratory Imaging s.r.o.</a></div><div style="height:30%;width:100%;"></div> </div> <!-- /#main --> </div> </div> </body> </html>
