<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="description" content=""> <meta name="keywords" content=" "> <title>N-STORM Z-Calibration (Agilent and LU4) | NIS-Elements</title> <link rel="stylesheet" type="text/css" href="../css/syntax.css"> <link rel="stylesheet" type="text/css" href="../css/font-awesome.min.css"> <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css"> <link rel="stylesheet" type="text/css" href="../css/modern-business.css"> <link rel="stylesheet" type="text/css" href="../css/customstyles.css"> <link rel="stylesheet" type="text/css" href="../css/boxshadowproperties.css"> <link rel="stylesheet" type="text/css" href="../css/ekko-lightbox.min.css"> <link rel="stylesheet" type="text/css" href="../css/ne.css"> <script src="../js/jquery.min.js"></script> <script src="../js/jquery.cookie.min.js"></script> <script src="../js/jquery.navgoco.min.js"></script> <script src="../js/bootstrap.min.js"></script> <script src="../js/ekko-lightbox.min.js"></script> <script src="../js/lightbox.js"></script> <script src="../js/lim_help.js"></script> <script src="../js/jscopy.js"></script> <link rel="shortcut icon" href="../images/favicon_ne.ico""> <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml"> </head> <body> <!-- find project homepage --> <!-- Navigation --> <nav class="navbar navbar-inverse navbar-static-top"> <div class="container-fluid topnavlinks"> <ul class="nav navbar-nav navbar-left"> <!-- separate search window: --> <!--<li><a onclick='window.open("SearchWindow.html","Search","toolbar=0,location=0,directories=0,status=0,menubar=0,top=100,left=100,height=800,width=600");'><img src="images/zoomimage.svg" class="icon"/></a></li>--> <!-- embedded iframe search window: --> <li class="pull-right"> <a href="search.html?frompage=nstorm.zcalibration.html" id="searchButton" class="searchButton btn btn-primary" title="Search"> <img src="../images/zoomimage.svg" class="icon"/> </a> <div class="searchButtonWrapper"> </div> </li> <li> <a class="fa fa-lg navbar-brand" href="man.html" alt="NIS-Elements"> <img src="../images/logo_ne.svg"/> </a> </li> <!-- entries without drop-downs appear here --> <li><a href="man.html">User Manual</a></li> <li><a href="cr.html">Menu Commands</a></li> <li class="dropdown active"> <a href="#" class="dropdown-toggle" data-toggle="dropdown">Applications<b class="caret"></b></a> <ul class="dropdown-menu"> <li><a href="gpa.html">GPA</a></li> <li><a href="nis.ai.html">NIS.ai</a></li> <li><a href="measurement.3d.html">3D Measurement</a></li> <li><a href="analysis.modules.html">Bio Analysis Modules</a></li> <li><a href="app.concrete.html">Concrete</a></li> <li><a href="database.html">Database</a></li> <li><a href="app.deconvolution.html">Deconvolution</a></li> <li><a href="app.edf.html">Extended Depth of Focus</a></li> <li><a href="app.filters.html">Filter Particle Analysis</a></li> <li><a href="app.fret.html">FRET</a></li> <li><a href="app.ga3.html">General Analysis 3 </a></li> <li><a href="ug.hcajobs.html">HCA</a></li> <li><a href="app.hdr.html">HDR</a></li> <li><a href="GS_HowTo.IlluminationSequence.html">Illumination Sequence</a></li> <li><a href="ug.jobs.html">JOBS and HCA</a></li> <li><a href="app.layers.html">Layer Thickness Measurement</a></li> <li><a href="app.sequencer.html">Measurement Sequencer</a></li> <li><a href="app.metalo.castiron.html">Metalo - Cast Iron Analysis</a></li> <li><a href="app.metalo.grainsize.html">Metalo - Grain Size Analysis</a></li> <li><a href="app.nstorm.html">N-STORM</a></li> <li><a href="howto.triggeredacquisition.html">Triggered Acquisition</a></li> <li><a href="app.objectclassifier.html">Object Classifier</a></li> <li><a href="app.se.html">Smart Experiment</a></li> <li><a href="howto.tracking.html">Tracking</a></li> <li><a href="app.welds.html">Weld Measurement</a></li> </ul> </li> <li><a href="fr.html">Macro Functions</a></li> <!-- toggle sidebar button --> <!-- <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li> --> </ul> </div> <!-- /.container --> </nav> <!-- Page Content --> <div class=""> <div id="main" class="fixedPage"> <!-- Sidebar Column --> <div class="fixedSidebar" id="tg-sb-sidebar"> <!--<p>--> <ul id="mysidebar" class="nav"> <li class="sidebarTitle">NIS-Elements AR </li> <li class="sidebarSub "> <a title="N-STORM" href="app.nstorm.html">N-STORM</a> </li> <li class=" hidearrow"><a title="N-STORM Acquisition and Analysis" href="nstorm.external.html">N-STORM Acquisition and Analysis</a> <ul> </ul> </li> <li class=" "><a title="Control Windows" href="p2c20s2.html">Control Windows</a> <ul> <li><a title="Molecule Options" href="molecule.options.html">Molecule Options</a></li> <li><a title="Molecule Analysis" href="molecule.analysis.html">Molecule Analysis</a></li> <li><a title="Reference" href="molecule.reference.html">Reference</a></li> </ul> </li> <li class="active hidearrow"><a title="N-STORM Z-Calibration (Agilent and LU4)" href="nstorm.zcalibration.html">N-STORM Z-Calibration (Agilent and LU4)</a> <ul> </ul> </li> <!--if you aren't using the accordion, uncomment this block:--> <!--<p class="external"> <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a> </p>--> </ul> <!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.--> <script>$("li.active").parents('li').toggleClass("active");</script> </div> <!-- Content Column --> <div class="fixedContent" id="tg-sb-content"> <div id="invalidHash"></div> <div class="section page"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="nstorm.zcalibration"></a>N-STORM Z-Calibration (Agilent and LU4)<button class="xmlid" data-clipboard-text="id|nstorm.zcalibrationx">üîó</button></h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s1">Overview</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s2">Acquisition of Z-Calibrations with Agilent laser box</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s3">Acquisition of Z-Calibrations with LU4 laser box</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s4">3D Calibration</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s5">Generating a 2D Warp</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s6">Error messages during 3D calibrations</a></span></dt><dt><span class="section"><a href="nstorm.zcalibration.html#p2c20s3s7">N-STORM calibration commonly asked questions</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s1"></a>Overview<button class="xmlid" data-clipboard-text="id|p2c20s3s1x">üîó</button></h3></div></div></div><p>N-STORM uses the astigmatism method of 3D localization published by Huang et al. (<a class="ulink" href="https://science.sciencemag.org/content/319/5864/810" target="_blank">Science, 2008</a>). Molecules appear stretched in the x or y axis, with the orientation and magnitude of the stretch dependent on z position. A calibration of Gaussian width in x (Wx) and y (Wy) as a function of z position is generated by translating diffraction limited spots in the z dimension using a piezo stage insert (figure below). 100 nm TetraSpeck beads are used to z calibrate the three reporter wavelengths and also calculate a warp to correct registration between channels (correction for chromatic aberrations for both <span class="guilabel">xy</span> and <span class="guilabel">z</span>).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_01.png" title="" data-title="N-STORM z calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_01.png" alt="../img/eng/nstorm_calibration_01.png image"></a><p class="title"><b>Figure&nbsp;1336.&nbsp;N-STORM z calibration</b></p></div></div><p>The calibration steps are: collect 20 periods at the starting (in focus) position, move piezo to -800 nm at period 21, step piezo up in 10 nm increments to +800 nm, return piezo to starting (in focus) position for final 20 periods. The cylindrical lens changes the image of molecules' axial ratios as a function of z. The sequence can be performed simultaneously for all three reporter wavelengths (total of 603 frames).</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s2"></a>Acquisition of Z-Calibrations with Agilent laser box<button class="xmlid" data-clipboard-text="id|p2c20s3s2x">üîó</button></h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Connect the Mad City Labs Nano-Z100 piezo stage to the PC via USB only (no more analog connectors). In case the MCL NanoDrive module is installed make sure to go to <span class="emphasis"><em>Devices &gt; Device Manager</em></span> and disconnect the MCL NanoDrive module. Otherwise the piezo stage will not move.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_02.png" title="" data-title="Properly mounted calibration sample "><img class="img-responsive" src="../img/eng/nstorm_calibration_02.png" alt="../img/eng/nstorm_calibration_02.png image"></a><p class="title"><b>Figure&nbsp;1337.&nbsp;Properly mounted calibration sample</b></p></div></div><p>The setup for calibration with 35 mm glass bottom dish is shown. Other sample vessels and holders can be used, but must be secured similarly.</p><p>Make sure the insert is securely mounted to the piezo by the 6 small screws, then turn the unit on. Place the calibration sample on the stage and secure it with clips (figure above).</p></li><li class="step"><p>Insert the cylindrical lens.</p></li><li class="step"><p>Focus on the beads using any of the reporter wavelengths. Identify a field with a dispersed, uniform distribution of beads within the 256x256 region used for STORM. Avoid sparse fields and bead clumps (if beads are too close they will overlap when elongated which can lead to miss localizations).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_03.png" title="" data-title="100 nm Tetraspeck bead field "><img class="img-responsive" src="../img/eng/nstorm_calibration_03.png" alt="../img/eng/nstorm_calibration_03.png image"></a><p class="title"><b>Figure&nbsp;1338.&nbsp;100 nm Tetraspeck bead field</b></p></div></div><p>A good 256x256 pixel field has a sufficient number of beads which are evenly distributed. There are few clumps or overlapping beads.</p></li><li class="step"><p>Setup the desired reporter wavelengths by clicking on <span class="guibutton">Settings</span> in the N-STORM with the <span class="emphasis"><em>Agilent Acquisition</em></span> window. Label the three reporter channels and select the appropriate lasers (figure below, red boxes). The color for displaying localizations in each channel can also be set here. If a laser is not selected as reporter wavelength it will not be available in the Z-calibration dialog (see the next step).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_04.png" title="" data-title="Setting up the channels and lasers for calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_04.png" alt="../img/eng/nstorm_calibration_04.png image"></a><p class="title"><b>Figure&nbsp;1339.&nbsp;Setting up the channels and lasers for calibration</b></p></div></div><p>Label and select the appropriate lasers here. Cycle settings and activation probes are ignored for calibration. Also, 405 nm is not used as a reporter and cannot be calibrated.</p></li><li class="step"><p>Click <span class="quote">‚Äú<span class="quote">Z Calibration</span>‚Äù</span> in the N-STORM with the <span class="emphasis"><em>Agilent Acquisition</em></span> window (figure below, left). The window will change to calibration mode (figure below, right) and the piezo will immediately home to the center of its range. You will therefore have to refocus by moving up 50 ¬µm.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_05.png" title="" data-title="Calibration settings "><img class="img-responsive" src="../img/eng/nstorm_calibration_05.png" alt="../img/eng/nstorm_calibration_05.png image"></a><p class="title"><b>Figure&nbsp;1340.&nbsp;Calibration settings</b></p></div></div><p>Acquisition dialog is switched to calibration mode by clicking <span class="quote">‚Äú<span class="quote">Z Calibration</span>‚Äù</span> (left, red circle). The reporter wavelengths to be calibrated are checked and path/filenames specified. <span class="guibutton">Run Now</span> button begins the calibration routine outlined in the <span class="quote">‚Äú<span class="quote">N-STORM z calibration</span>‚Äù</span> figure.</p></li><li class="step"><p>Check the boxes corresponding to the reporters to be calibrated, and specify the path and name of the calibration file (figure above, right).</p></li><li class="step"><p>As a final step, go live using the camera and refocus on the beads. Adjust laser power to give a good signal to noise ratio in each channel. Also check for the out of focus levels where the beads are elongated. At the same time you should avoid saturation in the in-focus frames. Use the <span class="quote">‚Äú<span class="quote">Piezo Z move</span>‚Äù</span> arrows (figure above, green box) to set the step size and fine tune focus with the piezo. The goal is to get beads as round as possible (axial ratio ~ 1). Zooming in helps in this regard.</p></li><li class="step"><p>Press <span class="guibutton">Run Now</span> to acquire the calibration (figure above, red arrow).</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s3"></a>Acquisition of Z-Calibrations with LU4 laser box<button class="xmlid" data-clipboard-text="id|p2c20s3s3x">üîó</button></h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Connect the Mad City Labs Nano-Z100 piezo stage to the PC via USB only (no more analog connectors). In case MCL NanoDrive module is installed, make sure to go to <span class="emphasis"><em>Devices &gt; Device Manager</em></span> and disconnect the MCL NanoDrive module. Otherwise the piezo stage will not move.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_02.png" title="" data-title="Properly mounted calibration sample "><img class="img-responsive" src="../img/eng/nstorm_calibration_02.png" alt="../img/eng/nstorm_calibration_02.png image"></a><p class="title"><b>Figure&nbsp;1341.&nbsp;Properly mounted calibration sample</b></p></div></div><p>The setup for calibration with 35 mm glass bottom dish is shown. Other sample vessels and holders can be used, but must be secured similarly.</p><p>Make sure the insert is securely mounted to the piezo by the 6 small screws, then turn the unit on. Place the calibration sample on the stage and secure it with the clips (figure above).</p></li><li class="step"><p>Insert the cylindrical lens.</p></li><li class="step"><p>Focus on the beads using any of the reporter wavelengths. Identify a field with a dispersed, uniform distribution of beads within the 256x256 region used for STORM. Avoid sparse fields and bead clumps (if beads are too close they will overlap when elongated which can lead to miss localizations).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_03.png" title="" data-title="100 nm Tetraspeck bead field "><img class="img-responsive" src="../img/eng/nstorm_calibration_03.png" alt="../img/eng/nstorm_calibration_03.png image"></a><p class="title"><b>Figure&nbsp;1342.&nbsp;100 nm Tetraspeck bead field</b></p></div></div><p>A good 256x256 pixel field has a sufficient number of beads which are evenly distributed. There are few clumps or overlapping beads.</p></li><li class="step"><p>Setup the desired reporter wavelengths by clicking on <span class="guibutton">Settings</span> in the N-STORM window. Select <span class="guilabel">Multi-color Continuous Mode</span> and label the three reporter channels and select the appropriate lasers (figure below, red boxes). The color for displaying localizations in each channel can also be set here. If a laser is not selected as <span class="guilabel">reporter wavelength</span> it will not be available in the Z-calibration dialog and if it is not labelled correctly it will appear wrong in the z-calibration dialog (see the next step).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_06.png" title="" data-title="Setting up the channels and lasers for calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_06.png" alt="../img/eng/nstorm_calibration_06.png image"></a><p class="title"><b>Figure&nbsp;1343.&nbsp;Setting up the channels and lasers for calibration</b></p></div></div><p>Label and select the appropriate lasers here. Cycle settings and activation probes are ignored for calibration. Also, 405 nm is not used as a reporter and cannot be calibrated.</p></li><li class="step"><p>Click on <span class="guibutton">Advanced</span> in the <span class="guilabel">N-STORM</span> window and then on <span class="guibutton">Z Calibration</span> in the panel that appears below (figure below, left). Select <span class="guilabel">3D STORM</span>. The window will change to calibration mode (figure below, right) after a message that will ask you to put in the cylindrical lens, the piezo will immediately home to the center of its range (you will therefore have to refocus by moving up 50 ¬µm) and all the lasers go to 0% while a live window appears. For refocusing select one laser channel and set the laser power to 5-10%.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_07.png" title="" data-title="Calibration settings "><img class="img-responsive" src="../img/eng/nstorm_calibration_07.png" alt="../img/eng/nstorm_calibration_07.png image"></a><p class="title"><b>Figure&nbsp;1344.&nbsp;Calibration settings</b></p></div></div><p>Acquisition dialog is switched to calibration mode by clicking <span class="guibutton">Z Calibration</span> (left, red circle). The reporter wavelengths to be calibrated are checked and path/filenames specified. <span class="guibutton">Run Now</span> button begins the calibration routine outlined in the <span class="quote">‚Äú<span class="quote">N-STORM z calibration</span>‚Äù</span> figure.</p></li><li class="step"><p>Check the boxes corresponding to the reporters to be calibrated, and specify the path and name of the calibration file (figure above, right).</p></li><li class="step"><p>As a final step, adjust laser power to give a good signal to noise ratio in each channel. Check for this also out of focus levels where the beads are elongated. At the same time you should avoid saturation in the in-focus frames. Use the <span class="quote">‚Äú<span class="quote">Piezo Z move</span>‚Äù</span> arrows (figure above, green box) to set the step size and fine tune focus with the piezo. The goal is to get beads as round as possible (axial ratio ~ 1). For the fine adjustment you can use the Axial Ratio test tool (figure above, red box and snapshot below). By pressing <span class="guibutton">Test Ax</span> the N-STORM Graph Ax window opens up. You can see the live axial ratio for all selected colors. By selecting the range and the Auto Scroll period number you can adjust the graph. Bring the axial ratio of all colors as close as possible to 1 by moving up and down with the piezo (red box in the figure below). The differences you can see between the colors are due to chromatic aberrations that can be corrected later on.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_08.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/nstorm_calibration_08.png" alt="../img/eng/nstorm_calibration_08.png image"></a><p class="title"><b>Figure&nbsp;1345.&nbsp;</b></p></div></div></li><li class="step"><p>Press <span class="guibutton">Run Now</span> to acquire the calibration (figure above - Calibration settings, red arrow).</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s4"></a>3D Calibration<button class="xmlid" data-clipboard-text="id|p2c20s3s4x">üîó</button></h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Open the <span class="guilabel">N-STORM Analysis Module</span> and load the calibration ND2 file.</p></li><li class="step"><p>Set the Identification S6ettings (figure below, left - Identification of beads for 3D calibration) for each channel low enough that beads are picked up in the out of focus frames. It is important to realize that in order to get a calibration of +/- 400 nm around focus only the most central 80 frames are needed (figure below). In these 80 frames it is important to get as many but also as reliable identifications as possible. Therefore, you should select a frame between 40 and 50 and base your identification settings on this frame. Make sure that you get around 50% of the beads identified. Recheck your settings on frame 160. Also here you should have around 50%.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_01.png" title="" data-title="Reasonable calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_01.png" alt="../img/eng/nstorm_calibration_01.png image"></a><p class="title"><b>Figure&nbsp;1346.&nbsp;Reasonable calibration</b></p></div></div><p>Finally, check your settings on frame 60, 100 and 140. In these 3 frames you should get as many beads identified as possible and as little false positive as possible. Use the <span class="quote">‚Äú<span class="quote">Test</span>‚Äù</span> function to confirm this for all channels prior to running the analysis (figure below, right). Run a 3D analysis (figure below, red arrow) of the calibration data.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_10.png" title="" data-title="Identification of beads for 3D calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_10.png" alt="../img/eng/nstorm_calibration_10.png image"></a><p class="title"><b>Figure&nbsp;1347.&nbsp;Identification of beads for 3D calibration</b></p></div></div><p>Select the minimum height for each channel. In this example, a minimum height of 4000 for the 561 channel (left) results in identification of molecules in period 21 (right), corresponding to a z position of -800 nm.</p></li><li class="step"><p>To z calibrate, click on <span class="guibutton">Z Calibration</span> in the <span class="guilabel">Identification Settings</span> window (figure below - Generating the z calibration, red arrow). By pressing the <span class="guibutton">Graph</span> button in the Z-calibration dialog and then holding shift while selecting Axial Ratio vs. Period (frame average) a graph will pop up that will show the changes in the axial ratio as function of frame number of all acquired channels (up to 3, figure below, lower panel). Use this graph to judge if the calibration will be OK. Please check for this if the (almost) linear behavior of the curves covers a range of at least 600 nm (in the case below it is around 800 nm, from frame 60 to 140 = 8 frames of 10 nm steps = 800 nm).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_11.png" title="" data-title="Judging the quality of the Z-calibration data "><img class="img-responsive" src="../img/eng/nstorm_calibration_11.png" alt="../img/eng/nstorm_calibration_11.png image"></a><p class="title"><b>Figure&nbsp;1348.&nbsp;Judging the quality of the Z-calibration data</b></p></div></div><p>If correct, press <span class="guibutton">Auto Calibrate</span> in the <span class="guilabel">Z Calibration</span> window (figure below, green arrow). There is a pause while the calibration is generated, after which the <span class="guibutton">Auto Calibrate</span> button is grayed out. New values and graphs will populate the dialog if calibration is successful (figure above, top right panel). The software automatically sets the range of the calibration depending on the quality of the data (figure below, red box). The difference between start and end point should be in the range of 600-1200 nm. Usually it will be around 800-900 nm.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_12.png" title="" data-title="Generating the z calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_12.png" alt="../img/eng/nstorm_calibration_12.png image"></a><p class="title"><b>Figure&nbsp;1349.&nbsp;Generating the z calibration</b></p></div></div><p>The <span class="guilabel">Z Calibration</span> window on the right is opened through the <span class="guilabel">Identification Settings</span> window (red arrow). Pressing <span class="guibutton">Auto Calibrate</span> (green arrow) calibrates the system. Clicking <span class="guibutton">OK</span> and <span class="guibutton">OK</span> again applies the calibration to the system.</p><p>If the calibration fails, the following error message will pop up.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_13.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/nstorm_calibration_13.png" alt="../img/eng/nstorm_calibration_13.png image"></a><p class="title"><b>Figure&nbsp;1350.&nbsp;</b></p></div></div><p>In the location where your acquired z-calibration file is stored you will now find a file with time and date as file name with the ending .log. At the very bottom of the file you will find an error message. Please see the <span class="guilabel">Error messages during 3D calibrations</span> chapter for the meaning of different error messages and to find suggestions how to avoid the errors.</p></li><li class="step"><p>If successful, evaluate the result of the calibration by checking the newly accessible calibration graphs (see typical graphs below). Note they are only available right after performing the auto calibration. The Z-calibration graph should display two crossing curves as shown below. Ideally the fitted yellow and blue curves are symmetric. Adjusting the correction collar may be needed if the curves are not symmetric. The axial frame average vs. z position graph should show a linear behavior over the central 800 nm (see example below). Any back curling should be avoided. If starting and end points should be around aspect ratio of 1. If they are far off (like in the shown example) please rerun the calibration and focus the starting point better. Finally, the average per frame of Wx vs. Wy should show a c-like shape. Again back curling should be avoided by all means. These three types of graphs are separately available per channel of the calibration data.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_14.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/nstorm_calibration_14.png" alt="../img/eng/nstorm_calibration_14.png image"></a><p class="title"><b>Figure&nbsp;1351.&nbsp;</b></p></div></div><p>If the results are not satisfactory, press <span class="guibutton">Cancel</span> to revert back to the original calibration. To accept and apply the new calibration to the system <span class="guibutton">OK</span> must be clicked twice, first in the <span class="guilabel">Z Calibration</span> window then in the <span class="guilabel">Identification Settings</span> window (figure above - Generating the z calibration). Please see the <span class="guilabel">N-STORM Analysis</span> help file (see <a class="xref" href="nstorm.external.html">N-STORM Acquisition and Analysis</a>) for a description of the parameters displayed at the end of calibration and description of calibration graphs.</p></li><li class="step"><p>After z-calibration is complete, you can now correct for chromatic aberrations, using the same data set. For this click <span class="guibutton">Calibrate</span> under XY Warp in the ID Settings window (figure below, yellow arrow). A window opens displaying the result of the warp (figure below, right). Click <span class="guibutton">OK</span> to apply the 3D Warp to the system. This step can be skipped if the warping will not be used.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_15.png" title="" data-title="Calibrating the system warp "><img class="img-responsive" src="../img/eng/nstorm_calibration_15.png" alt="../img/eng/nstorm_calibration_15.png image"></a><p class="title"><b>Figure&nbsp;1352.&nbsp;Calibrating the system warp</b></p></div></div><p>Clicking <span class="quote">‚Äú<span class="quote">Calibrate</span>‚Äù</span> (yellow arrow) calculates the warp. The result window (right) opens when the warp is successful.</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s5"></a>Generating a 2D Warp<button class="xmlid" data-clipboard-text="id|p2c20s3s5x">üîó</button></h3></div></div></div><p>The cylindrical lens introduces a small distortion to the image. For this reason, it is necessary to generate a separate warp if channel registration is to be corrected for 2D experiments collected without the cylindrical lens. The workflow is similar to the steps described above for 3D, and is summarized below.</p><div class="procedure"><ol class="procedure" type="1"><li class="step"><p>Remove the cylindrical from the light path.</p></li><li class="step"><p>Bring the beads into focus with the piezo and collect a calibration file for all channels to be warped as in steps 3-8 above. Note, that there will be no asymmetric stretch of beads without the cylindrical lens but the beads will blur instead.</p></li><li class="step"><p>Open and analyze the calibration file, this time using 2D analysis parameters (figure below). Also you should choose your identification settings depending on an in-focus frame (one of the first or last 20 frames of the acquisition or around frame 100 of the acquisition. These are the frames that should be in focus). As the 2D warp calibration only has to correct in 2D the warp correction is based on the frame where the beads are best focused (axial ratio closest to 1). Therefore, the identification settings can be more strict than in the 3D case where also out of focus beads need to be fitted.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_16.png" title="" data-title="Analysis for 2D warp "><img class="img-responsive" src="../img/eng/nstorm_calibration_16.png" alt="../img/eng/nstorm_calibration_16.png image"></a><p class="title"><b>Figure&nbsp;1353.&nbsp;Analysis for 2D warp</b></p></div></div><p>By unchecking <span class="quote">‚Äú<span class="quote">3D</span>‚Äù</span> in the <span class="guilabel">Identification Settings</span> window (red arrow), screening parameters are changed for analysis of 2D experiments collected without the cylindrical lens.</p></li><li class="step"><p>Click <span class="guibutton">Calibrate</span> under XY Warp (figure above, yellow arrow). A warp for 2D is generated and a window opens displaying the result of the warp (figure below). Click <span class="guibutton">OK</span> to apply the 2D Warp to the system. This step can be skipped if warping will not be used.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_17.png" title="" data-title="2D warp result "><img class="img-responsive" src="../img/eng/nstorm_calibration_17.png" alt="../img/eng/nstorm_calibration_17.png image"></a><p class="title"><b>Figure&nbsp;1354.&nbsp;2D warp result</b></p></div></div><p>Note that the window now specifies that the 2D warp is generated (green circles).</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s6"></a>Error messages during 3D calibrations<button class="xmlid" data-clipboard-text="id|p2c20s3s6x">üîó</button></h3></div></div></div><p>The z-calibration algorithm automatically judges how good the acquired data of the z-calibration data file is. The quality of the data set depends both on the quality of the acquisition but also on the quality of the analysis. Thereby, selecting strict identification settings for the analysis of the z-calibration dataset can result in a better calibration curve.</p><p>In the following section the checkpoints and the criteria that the software applies are described. You will also find some suggestions how to resolve the situation if you get error messages following a failure at one or the other checkpoint. Note that only the first criterion that fails will generate the error message. Therefore several improvement steps might be needed before a calibration succeeds.</p><p><span class="guilabel">What are the criteria the software uses to judge if the z-calibration is OK or not:</span></p><p>Let`s have a look at the average per frame graph of a rather good (almost ideal) calibration data set. Vertical axis is the average per frame axial ratio. The horizontal axis is the period number (or for a single channel acquisition). The points (A, B, C, D, E, F, G) will help to define the constraints.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_18.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/nstorm_calibration_18.png" alt="../img/eng/nstorm_calibration_18.png image"></a><p class="title"><b>Figure&nbsp;1355.&nbsp;</b></p></div></div><p>The first 20 frames of a z-calibration are acquired near the focal plane (data between points A and B on the graph). It is called the <span class="quote">‚Äú<span class="quote">first plateau</span>‚Äù</span>. Similarly the <span class="quote">‚Äú<span class="quote">second plateau</span>‚Äù</span> is the last 20 frames (data between points F and G). All points between B and F are acquired during the piezo scan in the middle between the two plateaus. In the scan extremes (between B and C and between E and F) optical aberrations are often so bad that the data is highly distorted (for example Airy disks or bad noise, etc). These two regions are called <span class="quote">‚Äú<span class="quote">garbage</span>‚Äù</span> and the software tries to exclude them from calculation.</p><p>The points between C and E form a nice curve that is easy to follow and fit. Somewhere in the middle of that region there is point D where the axial ratio is closest to 1.</p><p>The small blue letters in the graph (a, b, c, d, e, f) represent the following constraints:</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_18.png" title="" data-title=" "><img class="img-responsive" src="../img/eng/nstorm_calibration_18.png" alt="../img/eng/nstorm_calibration_18.png image"></a><p class="title"><b>Figure&nbsp;1356.&nbsp;</b></p></div></div><div class="variablelist"><dl><div class="varlistentry"><span class="term">a) Absolute vertical position of first plateau</span> <p>The vertical position of every point between A and B must be within the range of 0.625 &lt; a &lt; 1.6 (note: 1 / 1.6 = 0.625).</p></div><div class="varlistentry"><span class="term">b) Flatness of the first plateau</span> <p>The vertical range of the points between A and B must be less than 0.1 to avoid a warning and less than 0.2 to avoid an error.</p></div><div class="varlistentry"><span class="term">c) Horizontal distance (in frames) between the beginning of the good data C and the midpoint D</span> <p>It must be at least 30 frames which equals 300 nm.</p></div><div class="varlistentry"><span class="term">d) Horizontal distance (in frames) between the beginning the midpoint D and the end of the good data E</span> <p>It also must be at least 30 frames.</p></div><div class="varlistentry"><span class="term">e) Same as <span class="quote">‚Äú<span class="quote">b</span>‚Äù</span> only for the second plateau (between F and G).</span> <p></p></div><div class="varlistentry"><span class="term">f) Same as <span class="quote">‚Äú<span class="quote">a</span>‚Äù</span> only for the second plateau (between F and G).</span> <p></p></div></dl></div><p>For multichannel acquisitions, each channel is evaluated independently. As you can imagine, satisfying all these requirements gets more difficult when:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p>you do 3 channels at once (because of chromatic aberrations),</p></li><li class="listitem"><p>you have an imperfect objective with asymmetrical PSF,</p></li><li class="listitem"><p>you start your acquisition far from the focal point,</p></li><li class="listitem"><p>you have excessive drift or vibrations,</p></li><li class="listitem"><p>piezo is not working properly.</p></li></ul></div><div class="orderedlist"><p class="title"><b>Possible error messages:</b></p><ol class="orderedlist" type="1"><li class="listitem"><p>Error! Channel[1 - Alexa 647] one of detected scan edges[58 120] is closer to detected midpoint[95] than min[30]</p><p>The horizontal (frame) position of your point C was 58, E was 120, and D was 95. Therefore D was not far enough from E (25 only instead of the required 30). Therefore criterion d is violated. A similar effect could happen for point C and criterion c.</p><p><span class="emphasis"><em>Solution: Your starting point is probably not well focused. If you start your calibration at an out of focus position the midpoint (axial ratio =1) will not be centered. Alternatively, your piezo might not move linearly.</em></span></p></li><li class="listitem"><p>Error! Channel[1 - 647nm] Average Ax Range[0.202741] is above tolerance [0.200000]</p><p>The flatness of the first plateau is not good enough. The variation in axial ratios during the first 20 steps is too high. Criterion b (or e) is violated.</p><p><span class="emphasis"><em>Solution: Check if your sample is well clamped. Also check if the anti-vibration works properly or if there is any other reason for vibrations (e.g. camera or other instrumentation on the system, air draft, construction work, etc.). Finally, also check if the beads on your sample are not floating and that all beads are in the same focal plane.</em></span></p></li><li class="listitem"><p>Warning! Channel[1 - 647nm] Average Ax Range[0.102741] is above tolerance[0.100000]</p><p>Same as error number 2 but this time only a warning is displayed. It means that your calibration is OK but you should check if there is a way to improve the situation.</p></li><li class="listitem"><p>Error! Channel[1 - 647nm] Min[1.000000] or Max[1.620727] Average Ax in starting plateau is outside of tolerance range[0.625000 - 1.600000]</p><p>One or several of the points in the first plateau is outside the tolerance range. This leads to a violation of criterion a (or f in case of the second plateau).</p><p><span class="emphasis"><em>Solution: Check if you start the z-calibration procedure in an in-focus position. If the starting plateau is OK but the end plateau not, you are most likely suffering from a drift. Please check if you sample is clamped well, that there is no airflow on the system and that there are no temperature fluctuations. Also check that frame averaging is disabled. Finally, make sure that the beads in your sample are not floating and that all the beads are in the same focal plain.</em></span></p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="p2c20s3s7"></a>N-STORM calibration commonly asked questions<button class="xmlid" data-clipboard-text="id|p2c20s3s7x">üîó</button></h3></div></div></div><div class="variablelist"><dl><div class="varlistentry"><span class="term">Why are my beads clumped together?</span> <p>Beads aggregate during storage. They must be vortexed or sonicated before and after diluting to ensure a good distribution on the coverslip.</p></div><div class="varlistentry"><span class="term">Should I calibrate with beads in water?</span> <p>Beads for calibration are imaged on the surface of the coverslip throughout the range of calibration. Therefore, the imaging medium has a negligible effect on the optical path length (spherical aberration) and imaging beads in air is acceptable. Calibration can be performed in water, but care must be taken that beads are not floating (which creates non-uniformity in axial ratios for a given z position).</p></div><div class="varlistentry"><span class="term">The piezo does not move. Is it broken?</span> <p>Check that the piezo controller is connected to the PC by USB and turned on and that the MCL NanoDrive module is disabled (if applicable) under the <span class="guilabel">Manage Devices</span> settings. Also, very long USB cables sometimes cause communication issues for the Nano-Z100 controller. A short cable may restore piezo movement in this instance.</p></div><div class="varlistentry"><span class="term">Why is there little to no stretch in the beads/molecules when I focus up and down?</span> <p>Make sure the cylindrical lens is in. If there is still no stretch, adjust the correction collar (turning it clockwise usually increases stretch, at the cost of enhancing optical aberrations that can hurt calibration). See the following question <span class="quote">‚Äú<span class="quote">Can I backup my z calibration</span>‚Äù</span> for more information on the correction collar.</p></div><div class="varlistentry"><span class="term">How many beads should be in the field for calibration?</span> <p>Enough to generate good statistics, while at the same time avoiding clumps and/or overlap. This is usually accomplished with 25-100 beads in the 256x256 pixel region.</p></div><div class="varlistentry"><span class="term">When I try to calibrate a warp I get an error that there is an <span class="quote">‚Äú<span class="quote">Insufficient number of calibration point pairs</span>‚Äù</span>. What does this mean?</span> <p>A warp is a non-linear transformation of one channel with respect to another. This means the registration shift is different throughout the field. The same beads are imaged with different wavelengths to act as fiducials mapping the registration offset between channels. To help ensure that the entire field is sampled a minimum of 10 beads must be successfully identified in both channels that are mapped to each other (there a three warps generated; 647 to 488, 561 to 488, 647 to 561). Lowering identification settings often results in more matching pairs. If the calibration still fails, move to a different field.</p></div><div class="varlistentry"><span class="term">Do I need to manually set maximum displacement and turn off drift correction when analyzing calibration data?</span> <p>Earlier versions of the N-STORM analysis required max displacement set to zero and drift correction manually turned off by the user for calibration, and then turned back on for experimental data. Analysis modules with N-STORM with Agilent version 1.0.9 and later (analysis module b85 or higher) recognize calibration files and automatically set these parameters.</p></div><div class="varlistentry"><span class="term">Can I backup my z calibration?</span> <p>Yes, you can. The z calibration can be saved as a text file. It is highly recommended to save a backup copy of the current system calibration with your original data. This text file is also useful to move calibration to an offline workstation. The calibration is saved and re-loaded through the <span class="guilabel">Z Calibration</span> dialog (figure below).</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_19.png" title="" data-title="Saving and loading z calibrations "><img class="img-responsive" src="../img/eng/nstorm_calibration_19.png" alt="../img/eng/nstorm_calibration_19.png image"></a><p class="title"><b>Figure&nbsp;1357.&nbsp;Saving and loading z calibrations</b></p></div></div><p>Click <span class="guibutton">Save</span> (green arrow) in the Z Calibration window to save the calibration as a text file. A saved calibration is re-loaded by clicking <span class="guibutton">Load</span> (red arrow). It is necessary to click <span class="guibutton">OK</span> twice.</p></div><div class="varlistentry"><span class="term">Where should the correction collar be set on my objective?</span> <p>If your N-STORM system is equipped with a 100x 1.49 NA TIRF objective it will have a correction collar. The position of this collar has a large impact on the z calibration. Generally, the position for 23 ¬∫C, 0.17 mm coverslip thickness is a good place to start. The collar should be set such that there is pronounced stretch in the molecules when they move out of focus. At the same time, it can be used to offset optical artifacts. These typically appear as holes in the diffraction limited spots at the extreme out of focus range (around -800 or +800 nm, figure below). The goal of collar adjustment is to maximize molecule stretch while minimizing the appearance of these holes, which will cause a reversal in the measured axial ratio and decrease system calibration range.</p><div class="sidebar"><div class="figure"><a data-toggle="lightbox" data-gallery="default" href="../img/eng/nstorm_calibration_20.png" title="" data-title="Molecule shapes and aberrations during z calibration "><img class="img-responsive" src="../img/eng/nstorm_calibration_20.png" alt="../img/eng/nstorm_calibration_20.png image"></a><p class="title"><b>Figure&nbsp;1358.&nbsp;Molecule shapes and aberrations during z calibration</b></p></div></div><p>Zoomed and cropped images of beads from opposite ends of a z calibration. At the -800 nm piezo position, the molecules appear stretched vertically with no significant aberration. Holes resulting from optical aberration are observed at the +800 nm piezo position. Correction collar adjustment can help balance the stretch and aberration.</p></div></dl></div></div></div><div class="footer"><a href="http://www.laboratory-imaging.com" class="footer" target="_blank">Copyright 1991-2025 Laboratory Imaging s.r.o.</a></div><div style="height:30%;width:100%;"></div> </div> <!-- /#main --> </div> </div> </body> </html>
